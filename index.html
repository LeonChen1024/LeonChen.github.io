<!DOCTYPE html>
<html >
<head>
    <meta charset="utf-8">
<title>LeonChen&#39;s Blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />



    <meta property="og:type" content="website">
<meta property="og:title" content="LeonChen&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="LeonChen&#39;s Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LeonChen&#39;s Blog">





<link rel="icon" href="/images/favicon.png">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111687087-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-111687087-1');
</script>


    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.png" alt="LeonChen&#39;s Blog" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item is-active"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/LeonChen1024">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
    <div class="card">
    
    <div class="card-image">
        <a href="/2020/07/28/Trie/" class="image is-7by1">
            <img class="banner" src="/2020/07/28/Trie/title.jpg" alt="Trie(前缀树)">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-07-27T16:00:00.000Z">2020-07-28</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/Algorithm/">Algorithm</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/Algorithm/Common/">Common</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    22 minutes read (About 3302 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/07/28/Trie/">Trie(前缀树)</a>
            
        </h1>
        <div class="content">
            <!-- <h1><span id="trie">Trie</span></h1><p>Trie ,也叫做 digital tree(数字树) 有时候也是 <a href="todo">radix tree(基数树)</a> 或者 prefix tree(前缀树) (因为他们可以通过前缀进行搜索) 是一种 <a href="todo">search tree</a> - 一种用来存储通常键为 <a href="todo">strings</a> 的<a href="todo">dynamic set</a> 或者 <a href="todo">associative array</a>  有序的 <a href="todo">tree</a> 数据结构. 不像 <a href="todo">binary search tree(二叉搜索树)</a> , Trie 树里的节点不存储与该节点关联的键,而是使用他在树里的位置来表明它所关联的键.一个节点的所有子节点都有该节点关联的字符串前缀,并且根节点关联的是一个空字符串.键倾向于与叶子关联,也有一些内部节点也有关联了键.因此,并不是每一个节点都会有关联的键.有关于前缀树的空间优化,可以参考 <a href="todo">compact prefix tree</a> .</p>
<p><img src="/2020/07/28/Trie/Trie-example.png" alt=""></p>
<p>如同示例所示,键展示在节点中,而值在节点的下面.每一个英文单词都有一个值.一个 trie 可以视为一个 树形的 <a href="todo">deterministic finite automaton</a> . 每一个 <a href="https://en.wikipedia.org/wiki/Finite_language" target="_blank" rel="external">有限语言(finite language)</a> 都是由一个 trie 自动机(automaton)生成的,并且每个 trie 可以被压缩成一个 <a href="https://en.wikipedia.org/wiki/Deterministic_acyclic_finite_state_automaton" target="_blank" rel="external">deterministic acyclic finite state automaton</a> . </p>
<p>它的键不仅仅可以使用字符串的字符,它同样可以使用相同的算法来适配一些相同功能的任何构造组成的有序列表,比如数字或者形状(shapes)的列表排序.特别是,一个 bitwise trie 是使用二进制数据的固定长度的 bit 来当做建,比如使用一个整数或者存储器地址.</p>
<h2><span id="应用">应用</span></h2><h3><span id="替换其他数据结构">替换其他数据结构</span></h3><p>trie 和 binary search tree 相比有很多的优点. Trie 同样可以用来替换 <a href="../../../../OneDrive/Code/CodeRecord/Data-Structure/Hash-Table.md">hash table</a> ,它拥有以下的优点:</p>
<ul>
<li>Trie 对比一个不完美的 hash table 在最差的情况下查找数据更快,使用了 $O(m)$ 的时间( m 是查找的字符串的长度),而一个不完美的 hash table 会产生键碰撞.即不同的键被映射到相同的位置.它在最差的情况下的查找速度是 $O(N)$ ,但是通常情况下是 $O(1)$ 加上 $O(m)$  的计算 hash 的时间.</li>
<li>在 trie 里不存在不同的键的碰撞.</li>
<li>当一个键对应了多个值的情况下,trie 结构里的 bucket 和 hash table 的 bucket 类似,都会产生键碰撞.</li>
<li>当更多的键加入到 trie 里的时候不需要提供 hash 函数或者是改变 hash 函数.</li>
<li>trie 可以对条目的键进行字符排序. </li>
</ul>
<p>trie 也有一些缺点:</p>
<ul>
<li>trie 在某些情况下会比使用 hash table 来查找数据更加费时,特别是在当数据直接在硬盘驱动上访问或者在一些其他的存储设备也就是在那些 随机存取( random-access) 时间会高于使用 内存(main memory).</li>
<li>某些键,比如 floating point numbers, 会导致要检索一个很长的链条,使得前缀很长但是没有什么特别的意义.虽然如此,使用 bitwise trie 可以处理标准 IEEE single 和 double format floating point number.</li>
<li>有些 trie 会比 hash table 需要更多的空间,因为内存可能会给每一个查找的字符串里的字符分配空间,而不是如何大部分的 hash table 一样分配一大块的内存给全部条目.</li>
</ul>
<h3><span id="字典表达">字典表达</span></h3><p>trie 常用于存储  <a href="https://en.wikipedia.org/wiki/Predictive_text" target="_blank" rel="external">预测性文本(predictive text)</a>  或者 <a href="https://en.wikipedia.org/wiki/Autocomplete" target="_blank" rel="external">自动补全(autocomplete)</a> 的字典,比如<a href="https://en.wikipedia.org/wiki/Mobile_telephone" target="_blank" rel="external">mobile telephone</a> 上的查找功能.这样的应用程序利用了 trie 便于搜索,插入,和删除条目的优点;然而,如果只需要存储字典单词(不需要存储每个单词的附加信息),使用最小的 <a href="https://en.wikipedia.org/wiki/Deterministic_acyclic_finite_state_automaton" target="_blank" rel="external">deterministic acyclic finite state automaton</a> (DAFSA)(将同级的不同路径到达的代表相同字符的两个节点合并.) 将会占用更少的空间.这是因为它会在不同的单词开始存储的时候压缩 trie 中相同的分支(即拥有相同后缀或者部分后缀).</p>
<p>Trie 同样适用于实现近似匹配算法,包括那些 <a href="https://en.wikipedia.org/wiki/Spell_checking" target="_blank" rel="external">spell checking</a> and <a href="https://en.wikipedia.org/wiki/Hyphenation_algorithm" target="_blank" rel="external">hyphenation</a> 软件</p>
<h3><span id="术语索引">术语索引</span></h3><p><a href="https://en.wikipedia.org/w/index.php?title=Discrimination_tree&amp;action=edit&amp;redlink=1" target="_blank" rel="external">discrimination tree</a> <a href="https://en.wikipedia.org/wiki/Term_indexing" target="_blank" rel="external">term index</a> 将他的信息存储在 Trie 中.</p>
<h2><span id="算法">算法</span></h2><p>Trie 是一个支持查找和插入操作的节点树.</p>
<p>查找返回 键对应的值,插入则插入一个字符串(键) 和它对应的值到 Trie 里.这两个操作的耗时都是 $O(n)$ ,n 是键的长度.</p>
<p>下面这个简单 Node 类可以用来代表 Trie 中的节点:</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment"># a class representation for trie node</span></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Node</span><span class="hljs-params">()</span>:</span></div><div class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span></div><div class="line">        <span class="hljs-comment"># NOde that using dictionary for children (as in this implementation) would not allow</span></div><div class="line">        <span class="hljs-comment"># lexicographic sorting mentioned in the next section (Sorting),</span></div><div class="line">        <span class="hljs-comment"># because ordinary dictionary would not preserve the order of the keys</span></div><div class="line">        </div><div class="line">        <span class="hljs-comment"># mapping from character ==&gt; Node</span></div><div class="line">        self.children = &#123;&#125; </div><div class="line">        self.value = <span class="hljs-keyword">None</span></div></pre></td></tr></table></figure>
<p>注意 <code>children</code> 是这个节点的后代的字符键字典;并且”终端”节点是一个代表完整字符串的节点.</p>
<p>查找 Trie 的值的方法如下:</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment"># find a node value with key</span></div><div class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">find</span><span class="hljs-params">(node,key)</span>:</span></div><div class="line">    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> key:</div><div class="line">        <span class="hljs-comment"># if char in the node's children ,then go on to find next char</span></div><div class="line">        <span class="hljs-keyword">if</span> char <span class="hljs-keyword">in</span> node.children:</div><div class="line">            node = node.children[char]</div><div class="line">        <span class="hljs-keyword">else</span>:</div><div class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">None</span></div><div class="line">    <span class="hljs-keyword">return</span> node.value</div></pre></td></tr></table></figure>
<p>插入操作通过要插入的键字符串来执行 Trie ,当出现 Trie中没有出现的字符层级的时候就添加新的节点给这个后缀.</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment"># insert a node with key and value</span></div><div class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">insert</span><span class="hljs-params">(root,string,value)</span>:</span></div><div class="line">    node = root</div><div class="line">    index_last_char = <span class="hljs-keyword">None</span></div><div class="line">    <span class="hljs-keyword">for</span> index_char ,char <span class="hljs-keyword">in</span> enumerate(string):</div><div class="line">        <span class="hljs-keyword">if</span> char <span class="hljs-keyword">in</span> node.children:</div><div class="line">            node = node.children[char]</div><div class="line">        <span class="hljs-keyword">else</span>:</div><div class="line">            index_last_char = index_char</div><div class="line">            <span class="hljs-keyword">break</span></div><div class="line">    </div><div class="line">    <span class="hljs-comment"># append new nodes for the remaining characters , if any</span></div><div class="line">    <span class="hljs-keyword">if</span> index_last_char <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">None</span>:</div><div class="line">        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> string[index_last_char:]:</div><div class="line">            node.children[char] = Node()</div><div class="line">            node = node.children[char]</div><div class="line"></div><div class="line">    <span class="hljs-comment"># store value in the terminal node</span></div><div class="line">    node.value = value</div></pre></td></tr></table></figure>
<p>这里有一个 main 方法可以用来测试</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment"># a main method check for the trie</span></div><div class="line"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:</div><div class="line">    root = Node()</div><div class="line">    insert(root,<span class="hljs-string">"apple"</span>,<span class="hljs-number">43</span>)</div><div class="line">    insert(root,<span class="hljs-string">"else"</span>,<span class="hljs-number">41</span>)</div><div class="line">    insert(root,<span class="hljs-string">"banana"</span>,<span class="hljs-number">435</span>)</div><div class="line">    insert(root,<span class="hljs-string">"leon"</span>,<span class="hljs-number">2</span>)</div><div class="line">    insert(root,<span class="hljs-string">"application"</span>,<span class="hljs-number">55</span>)</div><div class="line">    insert(root,<span class="hljs-string">"app"</span>,<span class="hljs-number">11</span>)</div><div class="line"></div><div class="line">    print(find(root,<span class="hljs-string">"app"</span>))</div></pre></td></tr></table></figure>
<h3><span id="排序">排序</span></h3><p>词典(Lexicographic) 可以通过构建一个 Trie 来对它键的集合进行排序,使用<a href="https://en.wikipedia.org/wiki/Tree_traversal#Pre-order" target="_blank" rel="external">pre-order</a>(左子树优先于右子树处理)进行遍历,只打印出叶子值.这个算法是  <a href="https://en.wikipedia.org/wiki/Radix_sort" target="_blank" rel="external">radix sort</a> 的一种形式.trie 是组成<a href="https://en.wikipedia.org/wiki/Burstsort" target="_blank" rel="external">Burstsort</a> 数据结构的基础,<a href="https://en.wikipedia.org/wiki/Burstsort" target="_blank" rel="external">Burstsort</a> 是2007年已知的最快的字符串排序算法.然而现在已经有了更快的字符串排序算法.</p>
<h3><span id="全文检索">全文检索</span></h3><p>我们可以使用一种特殊的 trie — <a href="https://en.wikipedia.org/wiki/Suffix_tree" target="_blank" rel="external">suffix tree</a> 来索引所有该文本的后缀来进行更快的全文检索.</p>
<h2><span id="实现">实现</span></h2><p>这里有几种方式来表示 Trie,根据内存使用和操作的效率做一个权衡.一个基础的形式是在一个 linked set 的节点,每个节点包含了一个 array 的子指针,一种方式是使用 <a href="https://en.wikipedia.org/wiki/Alphabet_(computer_science" target="_blank" rel="external">alphabet</a>) 中的每个符号(所以对于英语字母表来说,每个会存储26个子指针,如果使用字节的字符表的话要256个指针).这样处理是很简单的,但是会很浪费内存:使用字节字符表(总数256个)和四字节指针,每一个节点需要千字节的存储,并且当字符串的前缀没多少重复的时候,需要的节点数量大致是存储的字符串的总长度.换句话说,很多树底部附近的节点只有很少的子节点,这个结构浪费了大量的空间来存储空指针.</p>
<p>存储的问题可以通过 <em>alphabet reduction</em> 这个实现技术来优化,它通过将原始的字符串使用一个更小的字符集来重新解释为一个更长的字符串.比如,一个 n bytes 的字符串可以当做一个 2n 个 <a href="https://en.wikipedia.org/wiki/Nibble" target="_blank" rel="external">four-bit units</a> 的字符串,这样存储在 Trie 中的时候每个节点只需要16个指针.在最差的情况下查找需要访问两倍数量的节点,但是存储空间变为原来的八分之一.</p>
<p>另一种实现方法是使用一个三元元素(symbol,child,next)来代表节点并且使用<a href="https://en.wikipedia.org/wiki/Singly_linked_list" target="_blank" rel="external">singly linked list</a> 来链接子节点:child 指向节点的第一个子节点,next 指向父节点的下一个 child .子节点的集合还可以使用 <a href="https://en.wikipedia.org/wiki/Binary_search_tree" target="_blank" rel="external">binary search tree</a> 来表示.比如 <a href="https://en.wikipedia.org/wiki/Jon_Bentley_(computer_scientist" target="_blank" rel="external">Bentley</a>) and <a href="https://en.wikipedia.org/wiki/Robert_Sedgewick_(computer_scientist" target="_blank" rel="external">Sedgewick</a>) 开发的 <a href="https://en.wikipedia.org/wiki/Ternary_search_tree" target="_blank" rel="external">ternary search tree</a> 就是这个思想的实例.</p>
<p>为了避免使用256个指针(ASCII)数组,就像前面建议的那样,我们可以通过使用256 bit 的 bitmap来表示 ASCII 字符集,来显著的减少节点的数量.</p>
<p><img src="Resources/Pointer_implementation_of_a_trie.png" alt=""></p>
<p>一个 trie 实现的如同一个  <a href="https://en.wikipedia.org/wiki/Doubly_chained_tree" target="_blank" rel="external">doubly chained tree</a> 一样:垂直的箭头是 <code>child</code> 指针,水平虚线箭头是 <code>next</code> 指针.这个 trie 中的存储的字符串集合是 {baby, bad, bank, box, dad, dance} .这个列表按照允许字典顺序遍历还排序的.</p>
<h3><span id="bitwise-tries">Bitwise tries</span></h3><p>Bitwise trie 和常用的基于字符的 trie 是相同的除了它将遍历每一 bit 的方式变成了二叉树来提高了效率. 通常情况下,它的实现会使用一个特殊的 CPU 指令来快速的查找定长的键的第一个位的集合(比如,GCC 内置的<code>__builtin_clz()</code> ). 这个值用于索引一个 32- 或者 64- 位表指向 bitwise trie 的第一个项目包含这个数字所带有的前导零. 然后通过处理键后面的位来选择合适的 <code>child[0]</code> 或者 <code>child[1]</code>   知道找到对应的项目.</p>
<p>尽管这个处理听起来很慢,但是它由于对不依赖寄存器支持本地缓存并且具有高并发特性,所以他在现代的 <a href="https://en.wikipedia.org/wiki/Out-of-order_execution" target="_blank" rel="external">out-of-order execution</a> CPU 中可以有优秀的性能. <a href="https://en.wikipedia.org/wiki/Red-black_tree" target="_blank" rel="external">red-black tree</a> 在理论上拥有更好的性能表现,但是它对缓存很不友好并且会导致多通道并且 <a href="https://en.wikipedia.org/wiki/Translation_lookaside_buffer" target="_blank" rel="external">TLB</a> 在现代 CPU 情况下算法的性能受限于内存的延迟而不是 CPU 的速度.相比之下, bitwise trie 很少访问内存,当它需要使用的时候,它只需要读取,从而避免了 SMP 缓存一致性开销.因此,它快速成为许多快速插入和删除的代码算法的选择,就像内存分配器一样(最近流行的版本是  <a href="https://en.wikipedia.org/wiki/Malloc#dlmalloc" target="_blank" rel="external">Doug Lea’s allocator (dlmalloc) and its descendents</a> ).</p>
<h3><span id="compressing-tries">Compressing tries</span></h3><p>压缩 trie 并且合并相同分支这在有时候会提高很多性能.这个方法在以下情况中表现最佳:</p>
<ul>
<li>这个 trie 大部分是静态的(禁止在预先填充的 trie 中进行键的插入和删除)</li>
<li>只需要进行查找操作</li>
<li>trie 节点不是根据节点特定数据进行组键,或者节点的数据是通用的.</li>
<li>存储的键的集合在它的表现空间里非常的稀疏.</li>
</ul>
<p>比如,它可能被用来表示稀疏的  <a href="https://en.wikipedia.org/wiki/Bitset" target="_blank" rel="external">bitsets</a> ,也就是一个更大固定可以枚举的子集.在这种情况下,trie 是通过全部的集合内的位元素位置进行排键,这个键是根据字符串里的每一个元素需要被编码的完整的 bit 生成的.这种 trie 有一种非常退化的形式它的大量分支都消失了.在检测了通用模式的重复情况或者填充了不适用的缺口,独特的叶子节点( bit 字符串)可以存储并且轻松的压缩,减少了 trie 整体的大小.</p>
<p>这样的压缩方式同样适用于多个 <a href="https://en.wikipedia.org/wiki/Unicode" target="_blank" rel="external">Unicode</a> 字符的表的快速查找.这些包括了条件映射表(比如 希腊字母 pi,从Π 到 π),还包含了组合字符如德语等.</p>
<h3><span id="external-memory-trie">External memory trie</span></h3><p>几种变体适用于在外部存储器中维护字符串集和，包括后缀树。还建议将trie和B-tree组合称为B-trie用于此任务;与后缀树相比，它们在受支持的操作中受到限制，但也更紧凑，同时更快地执行更新操作。</p>
<h1><span id="about-me">About Me</span></h1><p>我的博客 <a href="http://leonchen1024.com/" target="_blank" rel="external">leonchen1024.com</a></p>
<p>我的 GitHub <a href="https://github.com/LeonChen1024" target="_blank" rel="external">https://github.com/LeonChen1024</a></p>
<p>微信公众号 </p>
<p><img src="https://github.com/LeonChen1024/LeetCodeRecord/blob/master/Images/CooderQRcodem.jpg?raw=true" alt="wechat"></p>
 -->
            <div class="article-entry">
                    
                    
                        
                            
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                            
                                
                                <p><h1><span id="trie">Trie</span></h1><p>Trie ,也叫做 digital tree(数字树) 有时候也是 <a href="todo">radix tree(基数树)</a> 或者 prefix tree(前缀树) (因为他们可以通过前缀进行搜索) 是一种 <a href="todo">search tree</a> - 一种用来存储通常键为 <a href="todo">strings</a> 的<a href="todo">dynamic set</a> 或者 <a href="todo">associative array</a>  有序的 <a href="todo">tree</a> 数据结构. 不像 <a href="todo">binary search tree(二叉搜索树)</a> , Trie 树里的节点不存储与该节点关联的键,而是使用他在树里的位置来表明它所关联的键.一个节点的所有子节点都有该节点关联的字符串前缀,并且根节点关联的是一个空字符串.键倾向于与叶子关联,也有一些内部节点也有关联了键.因此,并不是每一个节点都会有关联的键.有关于前缀树的空间优化,可以参考 <a href="todo">compact prefix tree</a> .</p>
<p><img src="/2020/07/28/Trie/Trie-example.png" alt=""></p>
<p>如同示例所示,键展示在节点中,而值在节点的下面.每一个英文单词都有一个值.一个 trie 可以视为一个 树形的 <a href="todo">deterministic finite automaton</a> . 每一个 <a href="https://en.wikipedia.org/wiki/Finite_language" target="_blank" rel="external">有限语言(finite language)</a> 都是由一个 trie 自动机(automaton)生成的,并且每个 trie 可以被压缩成一个 <a href="https://en.wikipedia.org/wiki/Deterministic_acyclic_finite_state_automaton" target="_blank" rel="external">deterministic acyclic finite state automaton</a> . </p>
<p>它的键不仅仅可以使用字符串的字符,它同样可以使用相同的算法来适配一些相同功能的任何构造组成的有序列表,比如数字或者形状(shapes)的列表排序.特别是,一个 bitwise trie 是使用二进制数据的固定长度的 bit 来当做建,比如使用一个整数或者存储器地址.</p>
<h2><span id="应用">应用</span></h2><h3><span id="替换其他数据结构">替换其他数据结构</span></h3><p>trie 和 binary search tree 相比有很多的优点. Trie 同样可以用来替换 <a href="../../../../OneDrive/Code/CodeRecord/Data-Structure/Hash-Table.md">hash table</a> ,它拥有以下的优点:</p>
<p>
                            
                        
                    
                    
                        </div>   
                        <div class="article-more-link">
                            <a href="/2020/07/28/Trie/#more">Read More</a>
                        </div>
                    
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2020/06/03/dependency-injection/" class="image is-7by1">
            <img class="banner" src="/2020/06/03/dependency-injection/title.jpg" alt="依赖注入">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-06-02T16:00:00.000Z">2020-06-03</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/DesignPattern/">DesignPattern</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/DesignPattern/Java/">Java</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    15 minutes read (About 2293 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/06/03/dependency-injection/">依赖注入</a>
            
        </h1>
        <div class="content">
            <!-- <h1><span id="依赖注入">依赖注入</span></h1><p>[TOC]</p>
<h1><span id="概述">概述</span></h1><p>依赖注入(Denpendecy Injection ,DI) 通常和 <a href="https://github.com/LeonChen1024/Excellent-Javaer/blob/master/principle/ioc.md" target="_blank" rel="external">控制反转(Inverse of Control,IoC)</a> 一起出现.它是实现IoC的主要手段之一.通过依赖注入类可以不关心自身的依赖应该如何构造,而是由注入器代理这个职责,将类需要的依赖构建好后注入到类里.可以达到分离关注点,分离调用方和依赖,提高可复用性和可维护性.</p>
<h2><span id="为什么需要依赖注入">为什么需要依赖注入</span></h2><p><strong>为什么需要依赖注入呢?</strong> 这和为什么需要IoC的原因基本相同.</p>
<p>在常规的开发过程中,很多时候一个类都是要依赖于其他的类才能实现某些功能,才能够更好的将关注点分离,比如一个车 <code>Car</code> 类 内部需要使用燃油引擎 <code>Engine</code> 类,那么他需要在 <code>Car</code> 的内部做类似 <code>new Engine()</code> 这样的操作, 看起来没有任何的问题,但是当需要更换引擎为他的子类电气引擎<code>ElectricEngine</code> 的时候,问题就来了,我们需要在 <code>Car</code> 的内部修改  <code>Engine</code>  类,或者是当 <code>Engine</code> 做了修改需要额外的参数的时候,也会需要改动到 <code>Car</code> 的内部,并且每个类都得对自身的依赖有更多的了解,这就违反了底米特原则(todo) 和 开闭原则(todo)导致了代码的耦合度极高,不利于维护和扩展.</p>
<p>如图</p>
<p><img src="https://img-blog.csdnimg.cn/20200603220407971.png" alt=""></p>
<p>这个时候我们将这个依赖创建获得的权利交给外部去维护,那么这个类只需要声明他需要一个 <code>Engine</code> 即可,至于是燃油还是电气的引擎就由外部控制,此时依赖不再是内部生成,而是通过外部注入得到,再碰到这样的问题的时候,就不需要更改 <code>Car</code> 内部的代码了.而是由外部代码控制即可.</p>
<p>如图</p>
<p><img src="https://img-blog.csdnimg.cn/20200603220429251.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NoZW5saW5mZW5nNzcyODg1Nzc1,size_16,color_FFFFFF,t_70" alt=""></p>
<p>依赖注入尾为我们解决了以下问题:</p>
<ul>
<li>如何让一个类和如何创建这个类互不关联</li>
<li>如何让类支持一定程度的可变性,提高可复用度</li>
<li>如何通过一些外部配置来控制对象的创建</li>
<li>如何让一个应用支持不同的配置</li>
</ul>
<h1><span id="细节">细节</span></h1><h2><span id="组成结构">组成结构</span></h2><p>依赖注入将依赖的创建和依赖的行为隔离开,这使得程序变得更加松耦合并且更加符合依赖反转原则(todo)和单一职责原则(todo).</p>
<p>最完全的依赖注入包含以下几个部分</p>
<ul>
<li>服务. 要使用的对象.</li>
<li>客户端. 依赖服务的对象.</li>
<li>接口. 定义客户端如何使用服务.</li>
<li>注入器. 构建服务并注入到客户端中.</li>
</ul>
<p>UML图如下:</p>
<p><img src="https://img-blog.csdnimg.cn/20200603220505308.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NoZW5saW5mZW5nNzcyODg1Nzc1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>用前面的汽车的例子对应</p>
<ul>
<li>服务. <code>Engine</code>, <code>ElectricEngine</code> </li>
<li>客户端.   <code>Car</code></li>
<li>接口. 比如 Engine 实现了一个 <code>IEngine</code> 接口, <code>Car</code> 内部使用 <code>IEngine</code> 前面的例子简化了这一步,我们可以看到像Spring 中使用的时候有时候也是会存在简化的情况.</li>
<li>注入器. 将<code>Engine</code> 注入到 <code>Car</code> 中的对象.</li>
</ul>
<p>常见的简化是直接使用了父子类来替代接口进行操作,这个需要根据情况具体分析.当然,这么做势必会违反依赖倒置原则和影响解耦程度.所以最优的情况是按照要求完整的实现它.</p>
<p>客户端不应该知道具体的依赖实现,而是只关心接口,而接口后面的变化则不会对客户端产生任何影响.</p>
<p>注入器通常也有很多别的名称,比如 提供者,容器,工厂等</p>
<h2><span id="实现方式">实现方式</span></h2><p>依赖注入有如下实现方式:</p>
<ul>
<li>手动注入. 不利于扩展,当程序不断庞大的时候,维护难度变高,并且需要维护大量的模板代码.<ul>
<li>基于接口.实现特定接口以供外部容器注入所依赖类型的对象.优点是依赖可以完全不了解客户端,都对接口负责即可.</li>
<li>基于 set 方法.实现特定属性的 <code>set</code> 方法，来让外部容器注入所依赖类型的对象.灵活性较高,任何时候都可以修改,但是由于过于灵活,无法确保依赖的完整,而且在所需依赖较多的时候,调用者难以判断需要哪些依赖.是否注入完整.并且暴露了注入接口,可能被其他对象意外调用.</li>
<li>基于构造函数.实现特定参数的构造函数，在新建对象时注入所依赖类型的对象. 使得依赖在刚创建对象的时候就被注入,保证了可靠性.但是灵活性较低,后面无法修改.</li>
</ul>
</li>
<li>自动注入. 便于维护,开发效率较高,代码清晰<ul>
<li>基于注解. 基于Java的注解功能(todo)，在私有变量前加 <code>@Autowired</code> 等注解，不需要显式的定义手动注入的那些代码，就可以让外部容器注入对应的对象.相当于定义了public的set方法，但是因为没有真正的set方法，减少了暴露的接口（使用set方法的话必须设置set方法为 public , 导致外部其他对象都可以显式随意的访问这个接口,但是这个依赖是否想要让外部访问修改还是个未知数.）</li>
</ul>
</li>
</ul>
<p>一般情况下使用 自动注入,注解注入的情况比较多.</p>
<p>目前比如 Spring,Guice,Dagger 等框架都实现了依赖注入的功能.</p>
<h3><span id="代码示例">代码示例</span></h3><ul>
<li>没有依赖注入的情况</li>
</ul>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">/** Client without DI */</span></div><div class="line">  <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> </span>&#123;</div><div class="line">    <span class="hljs-comment">// Internal reference to the service used by this client</span></div><div class="line">    <span class="hljs-keyword">private</span> ServiceImpl service;</div><div class="line"></div><div class="line">    Client() &#123;</div><div class="line">      <span class="hljs-comment">// Specify a specific implementation in the constructor instead of using dependency injection</span></div><div class="line">      service = <span class="hljs-keyword">new</span> ServiceImpl();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSth</span><span class="hljs-params">()</span> </span>&#123;</div><div class="line">      service.doSth();</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<ul>
<li>基于接口</li>
</ul>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">/** Client with interface DI */</span></div><div class="line">  <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ServiceSetter</span> </span>&#123;</div><div class="line">    <span class="hljs-comment">// Internal reference to the service used by this client</span></div><div class="line">    <span class="hljs-keyword">private</span> Service service;</div><div class="line"></div><div class="line">    Client() &#123;&#125;</div><div class="line"></div><div class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSth</span><span class="hljs-params">()</span> </span>&#123;</div><div class="line">      service.doSth();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="hljs-meta">@Override</span></div><div class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setService</span><span class="hljs-params">(Service service)</span> </span>&#123;</div><div class="line">      <span class="hljs-keyword">this</span>.service = service;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="hljs-comment">/** Service setter interface. */</span></div><div class="line">  <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ServiceSetter</span> </span>&#123;</div><div class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setService</span><span class="hljs-params">(Service service)</span></span>;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>​    </p>
<ul>
<li>基于 set 方法</li>
</ul>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">/** Client with setter DI */</span></div><div class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> </span>&#123;</div><div class="line">  <span class="hljs-comment">// Internal reference to the service used by this client</span></div><div class="line">  <span class="hljs-keyword">private</span> Service service;</div><div class="line"></div><div class="line">  Client() &#123;&#125;</div><div class="line"></div><div class="line">  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSth</span><span class="hljs-params">()</span> </span>&#123;</div><div class="line">    service.doSth();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">    <span class="hljs-comment">/**</span></div><div class="line"><span class="hljs-comment">    * set dependency in .</span></div><div class="line"><span class="hljs-comment">    */</span></div><div class="line">  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setService</span><span class="hljs-params">(Service service)</span> </span>&#123;</div><div class="line">    <span class="hljs-keyword">this</span>.service = service;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>基于构造器</li>
</ul>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">/** Client with constructor DI */</span></div><div class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> </span>&#123;</div><div class="line">  <span class="hljs-comment">// Internal reference to the service used by this client</span></div><div class="line">  <span class="hljs-keyword">private</span> Service service;</div><div class="line"></div><div class="line">  <span class="hljs-comment">// set dependency with constructor</span></div><div class="line">  Client(Service service) &#123;</div><div class="line">    <span class="hljs-keyword">this</span>.service = service;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSth</span><span class="hljs-params">()</span> </span>&#123;</div><div class="line">    service.doSth();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>基于注解</li>
</ul>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">/** Client with annotation DI */</span></div><div class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> </span>&#123;</div><div class="line">  <span class="hljs-comment">// Internal reference to the service used by this client</span></div><div class="line">  <span class="hljs-meta">@Inject</span></div><div class="line">  <span class="hljs-keyword">private</span> Service service;</div><div class="line"></div><div class="line">  Client() &#123;&#125;</div><div class="line"></div><div class="line">  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSth</span><span class="hljs-params">()</span> </span>&#123;</div><div class="line">    service.doSth();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1><span id="优点">优点</span></h1><ul>
<li>提高了客户端的灵活性,使得代码的可配置性得到提高. 客户端只关注自己需要的接口行为,而不强行绑定接口背后的实现逻辑,使得实现逻辑在一定程度上可以改变而不影响到客户端.</li>
<li>使得应用可以同时适配多种情况,通过注入不同的对象实现不同的逻辑.程序灵活性大大提高,在测试等方面有显著的效果.</li>
<li>分离关注点.客户端不再关心依赖的创建和许多细节问题.这样更有利于单元测试等.</li>
<li>提高了代码的复用性,可测试性和可维护性.</li>
<li>减少了模板代码,将创建依赖都交给了注入器去管理.</li>
<li>更有利于协同开发.由于大家都只对接口负责,那么不同的模块也可以方便有效的交给不同的人开发.类似插件的开发方式</li>
<li>减少了客户端和依赖间的耦合</li>
<li>分离了类的使用和创建</li>
</ul>
<h1><span id="缺点">缺点</span></h1><ul>
<li><p>如果没有使用合适的方法,会导致一些存在比较固定的默认对象的创建过程重复太多次,不利于维护.</p>
</li>
<li><p>提高了代码的学习成本,开发者必须了解DI的原理并且额外找到注入的对象才能理解这部分的逻辑.</p>
</li>
<li><p>提高了代码的使用难度.由于DI通常是通过反射或者APT技术实现的,所以对于IDE中的一些自动化操作会有所影响,比如 找到引用类,调用层级之类的.</p>
</li>
<li><p>提高了前期开发的成本.由于引入了DI技术,导致前期初始化依赖要做的事情变得复杂.虽然后期的维护成本将大大下降.</p>
</li>
</ul>
<h1><span id="about-me">About Me</span></h1><p>我的博客 <a href="http://leonchen1024.com/" target="_blank" rel="external">leonchen1024.com</a></p>
<p>我的 GitHub <a href="https://github.com/LeonChen1024" target="_blank" rel="external">https://github.com/LeonChen1024</a></p>
<p>微信公众号 </p>
<p><img src="https://img-blog.csdnimg.cn/20200313080010845.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NoZW5saW5mZW5nNzcyODg1Nzc1,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
 -->
            <div class="article-entry">
                    
                    
                        
                            
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                            
                                
                                <p><h1><span id="依赖注入">依赖注入</span></h1><p>[TOC]</p>
<h1><span id="概述">概述</span></h1><p>依赖注入(Denpendecy Injection ,DI) 通常和 <a href="https://github.com/LeonChen1024/Excellent-Javaer/blob/master/principle/ioc.md" target="_blank" rel="external">控制反转(Inverse of Control,IoC)</a> 一起出现.它是实现IoC的主要手段之一.通过依赖注入类可以不关心自身的依赖应该如何构造,而是由注入器代理这个职责,将类需要的依赖构建好后注入到类里.可以达到分离关注点,分离调用方和依赖,提高可复用性和可维护性.</p>
<h2><span id="为什么需要依赖注入">为什么需要依赖注入</span></h2><p><strong>为什么需要依赖注入呢?</strong> 这和为什么需要IoC的原因基本相同.</p>
<p>在常规的开发过程中,很多时候一个类都是要依赖于其他的类才能实现某些功能,才能够更好的将关注点分离,比如一个车 <code>Car</code> 类 内部需要使用燃油引擎 <code>Engine</code> 类,那么他需要在 <code>Car</code> 的内部做类似 <code>new Engine()</code> 这样的操作, 看起来没有任何的问题,但是当需要更换引擎为他的子类电气引擎<code>ElectricEngine</code> 的时候,问题就来了,我们需要在 <code>Car</code> 的内部修改  <code>Engine</code>  类,或者是当 <code>Engine</code> 做了修改需要额外的参数的时候,也会需要改动到 <code>Car</code> 的内部,并且每个类都得对自身的依赖有更多的了解,这就违反了底米特原则(todo) 和 开闭原则(todo)导致了代码的耦合度极高,不利于维护和扩展.</p>
<p>如图</p>
<p>
                            
                        
                    
                    
                        </div>   
                        <div class="article-more-link">
                            <a href="/2020/06/03/dependency-injection/#more">Read More</a>
                        </div>
                    
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2020/06/03/ioc/" class="image is-7by1">
            <img class="banner" src="/2020/06/03/ioc/title.jpg" alt="IoC 控制反转">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-06-02T16:00:00.000Z">2020-06-03</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/DesignPattern/">DesignPattern</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/DesignPattern/Java/">Java</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    11 minutes read (About 1632 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/06/03/ioc/">IoC 控制反转</a>
            
        </h1>
        <div class="content">
            <!-- <h1><span id="ioc-控制反转">IoC 控制反转</span></h1><p>[toc]</p>
<h1><span id="概述">概述</span></h1><p><strong>控制反转</strong>（Inversion of Control，缩写为<strong>IoC</strong>）,它是软件开发中的一种设计原则,可以降低代码的耦合度,使得程序更加的模块化,更易于扩展.</p>
<p>为什么叫做控制反转?又为什么能够降低代码的耦合度呢?</p>
<p>在常规的开发过程中,很多时候一个类都是要依赖于其他的类才能实现某些功能,才能够更好的将关注点分离,比如一个车 <code>Car</code> 类 内部需要使用燃油引擎 <code>Engine</code> 类,那么他需要在 <code>Car</code> 的内部做类似 <code>new Engine()</code> 这样的操作, 看起来没有任何的问题,但是当需要更换引擎为他的子类电气引擎<code>ElectricEngine</code> 的时候,问题就来了,我们需要在 <code>Car</code> 的内部修改  <code>Engine</code>  类,或者是当 <code>Engine</code> 做了修改需要额外的参数的时候,也会需要改动到 <code>Car</code> 的内部,并且每个类都得对自身的依赖有更多的了解,这就违反了底米特原则(todo) 和 开闭原则(todo)导致了代码的耦合度极高,不利于维护和扩展.</p>
<p>如图</p>
<p><img src="https://img-blog.csdnimg.cn/20200603213033955.png" alt="在这里插入图片描述"></p>
<p>在这种情况下,类的依赖创建获得是由类本身来进行控制的,所以在变动时也只能由类本身来操作.控制反转就是将这个控制依赖获得的权力交给外部,这么做的效果是怎么样的呢?</p>
<p>这个时候我们将这个依赖创建获得的权利交给外部去维护,那么这个类只需要声明他需要一个 <code>Engine</code> 即可,至于是燃油还是电气的引擎就由外部控制,<strong>这种由原来主动的控制创建依赖变为被动的接收注入的依赖对象,就是控制反转</strong>,再碰到这样的问题的时候,就不需要更改 <code>Car</code> 内部的代码了.而是由外部代码控制即可.</p>
<p>如图</p>
<p><img src="https://img-blog.csdnimg.cn/20200603213056864.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NoZW5saW5mZW5nNzcyODg1Nzc1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>当然,你也可以说你再实现一个类,就叫 <code>ElectricCar</code> 然后再维护这个类就可以,但是这样因为某个元素变化就会导致类的层级和数量迅速膨胀,导致难以维护.一但依赖元素过多,就是导致无法控制的类数量.比如我再增加一个轮胎,轮胎也有2个种类,那么光是 <code>Engine</code> 和 <code>Tire</code> 组合就需要4个 <code>Car</code> 类来实现</p>
<p>如图<br><img src="https://img-blog.csdnimg.cn/20200603213226823.png" alt="在这里插入图片描述"></p>
<p>总对比图<br><img src="https://img-blog.csdnimg.cn/20200603213319736.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NoZW5saW5mZW5nNzcyODg1Nzc1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1><span id="实现方法">实现方法</span></h1><p>前面说了 IoC 的理念,但是这只是一个思想,并不是一个实现方法,那么我们要如何实现 IoC呢?一般情况下有这么几种方法</p>
<h2><span id="依赖注入dependency-injection">依赖注入(dependency injection)</span></h2><p>顾名思义,也就是通过外部注入依赖到调用者,然后调用者就可以直接使用这个依赖了.这是控制反转中最常见的一种技术了.</p>
<p>依赖注入有如下实现方式:</p>
<ul>
<li>手动注入. 不利于扩展,当程序不断庞大的时候,维护难度变高,并且需要维护大量的模板代码.<ul>
<li>基于接口.实现特定接口以供外部容器注入所依赖类型的对象.</li>
<li>基于 set 方法.实现特定属性的 <code>set</code> 方法，来让外部容器注入所依赖类型的对象.</li>
<li>基于构造函数.实现特定参数的构造函数，在新建对象时注入所依赖类型的对象.</li>
</ul>
</li>
<li>自动注入. 便于维护,开发效率较高,代码清晰<ul>
<li>基于注解. 基于Java的注解功能(todo)，在私有变量前加 <code>@Autowired</code> 等注解，不需要显式的定义手动注入的那些代码，就可以让外部容器注入对应的对象.相当于定义了public的set方法，但是因为没有真正的set方法，减少了暴露的接口（使用set方法的话必须设置set方法为 public , 导致外部其他对象都可以显式随意的访问这个接口,但是这个依赖是否想要让外部访问修改还是个未知数.）</li>
</ul>
</li>
</ul>
<p>一般情况下使用 自动注入,注解注入的情况比较多.</p>
<p><a href="https://github.com/LeonChen1024/Excellent-Javaer/blob/master/technique/dependency-injection.md" target="_blank" rel="external">依赖注入详情点这里</a></p>
<h2><span id="依赖查找dependency-lookup">依赖查找(dependency lookup)</span></h2><p>这个方式一般情况下是作为依赖注入的一个补充,它主要是让类通过外部容器的接口来查找自己依赖的对象.方式更加主动,但是由于使用了容器的接口,所以无法在容器外使用,扩展性较低.</p>
<h2><span id="服务定位器模式service-locator-pattern">服务定位器模式(service locator pattern)</span></h2><p>也是一种用于软件开发的设计模式,通过一个完备的抽象层服务中央注册表,提供了所有需要的依赖.</p>
<p><strong>优势</strong></p>
<ul>
<li>允许运行时添加代码而不必重新编译.</li>
<li>可以在运行时有选择的从服务定位器添加和删除项目</li>
<li>完全解耦,程序之间的唯一连接就是注册表</li>
</ul>
<p><strong>缺点</strong></p>
<ul>
<li>注册表由于是直接在运行时使用的,所以有些异常无法在编译时发现.会出现运行时异常,比如找不到依赖项.</li>
<li>测试难度比较高.</li>
</ul>
<h2><span id="使用模板方法设计模式">使用模板方法设计模式</span></h2><p>通过模板方法设计模式将实例化的过程放到调用者去实现,这个方式的缺点就是和手动注入一样比较麻烦</p>
<h1><span id="扩展">扩展</span></h1><h2><span id="其他应用">其他应用</span></h2><p>不仅仅是这个,其实在回调,事件分发机制(todo),模板方法中都使用到了IoC 这个原则.</p>
<h1><span id="about-me">About Me</span></h1><p>我的博客 <a href="http://leonchen1024.com/" target="_blank" rel="external">leonchen1024.com</a></p>
<p>我的 GitHub <a href="https://github.com/LeonChen1024" target="_blank" rel="external">https://github.com/LeonChen1024</a></p>
<p>微信公众号 </p>
<p><img src="https://img-blog.csdnimg.cn/20200313080010845.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NoZW5saW5mZW5nNzcyODg1Nzc1,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
 -->
            <div class="article-entry">
                    
                    
                        
                            
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                            
                                
                                <p><h1><span id="ioc-控制反转">IoC 控制反转</span></h1><p>[toc]</p>
<h1><span id="概述">概述</span></h1><p><strong>控制反转</strong>（Inversion of Control，缩写为<strong>IoC</strong>）,它是软件开发中的一种设计原则,可以降低代码的耦合度,使得程序更加的模块化,更易于扩展.</p>
<p>为什么叫做控制反转?又为什么能够降低代码的耦合度呢?</p>
<p>在常规的开发过程中,很多时候一个类都是要依赖于其他的类才能实现某些功能,才能够更好的将关注点分离,比如一个车 <code>Car</code> 类 内部需要使用燃油引擎 <code>Engine</code> 类,那么他需要在 <code>Car</code> 的内部做类似 <code>new Engine()</code> 这样的操作, 看起来没有任何的问题,但是当需要更换引擎为他的子类电气引擎<code>ElectricEngine</code> 的时候,问题就来了,我们需要在 <code>Car</code> 的内部修改  <code>Engine</code>  类,或者是当 <code>Engine</code> 做了修改需要额外的参数的时候,也会需要改动到 <code>Car</code> 的内部,并且每个类都得对自身的依赖有更多的了解,这就违反了底米特原则(todo) 和 开闭原则(todo)导致了代码的耦合度极高,不利于维护和扩展.</p>
<p>如图</p>
<p>
                            
                        
                    
                    
                        </div>   
                        <div class="article-more-link">
                            <a href="/2020/06/03/ioc/#more">Read More</a>
                        </div>
                    
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2020/05/02/Serializable/" class="image is-7by1">
            <img class="banner" src="/2020/05/02/Serializable/title.jpg" alt="Serializable">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-05-01T16:00:00.000Z">2020-05-02</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/Java/">Java</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/Java/SourceCode/">SourceCode</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    11 minutes read (About 1603 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/05/02/Serializable/">Serializable</a>
            
        </h1>
        <div class="content">
            <!-- <h1><span id="serializable">Serializable</span></h1><p>通过实现 java.io.Serializable 可以让 class 实现序列化的功能，否则无法使用序列化的功能。一个实现序列化的类的子类都是可以进行序列化的。Serializable 接口没有方法，字段等只是一个标记它是可以序列化的作用。</p>
<p>序列化是指将数据结构或对象状态转换成可取用格式（例如存成文件，存于缓冲，或在网络中传送），并在需要的时候恢复原先状态的过程。</p>
<p>当子类实现了 Serializable 接口而父类没有实现的时候，父类要有一个可以访问的无参构造函数。</p>
<p>在反序列化的时候，没有实现序列化的类字段将会使用 public 或者 protect 的无参构造函数进行初始化。无参构造函数必须是实现序列化的子类可访问的，</p>
<p>如果需要在序列化和反序列化的时候进行一些特殊操作的话，需要自己实现以下某些方法：</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeObject</span><span class="hljs-params">(java.io.ObjectOutputStream out)</span></span></div><div class="line"><span class="hljs-function">    <span class="hljs-keyword">throws</span> IOException</span></div><div class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">readObject</span><span class="hljs-params">(java.io.ObjectInputStream in)</span></span></div><div class="line"><span class="hljs-function">    <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException</span>;</div><div class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">readObjectNoData</span><span class="hljs-params">()</span></span></div><div class="line"><span class="hljs-function">    <span class="hljs-keyword">throws</span> ObjectStreamException</span>;</div></pre></td></tr></table></figure>
<p>writeObject 方法负责写入指定的类的对象状态来让 readObject 方法可以读取这些状态。可以通过调用 out.defaultWriteObject 方法来使用默认的保存对象字段的机制。</p>
<p>readObject 方法负责从流中读取并回复类字段。它可能会调用 in.defaultReadObject 方法来默认恢复非静态和非临时(transient)的字段机制。defaultReadObject 方法使用流中的信息来分配流中保存的对象字段到目前的对象相应名字的字段中。这解决了当类已经添加了新的字段时的问题。</p>
<p>这两个方法不需要考虑它自己的父类或者子类。状态是通过 writeObject 方法将各自的字段写入到 ObjectOutputStream 中，或者通过 DataOutput 提供的方法将私有的数据类型进行保存。</p>
<p>readObjectNoData 方法负责在当序列化流没有列出指定的类作为反序列化的对象的父类的时候初始化对象的状态。这可能会发生在接收部分使用了一个和发送部分不同版本的反序列化实例的类的时候，还有接收的版本继承的类不是发送版本继承的类的时候。还可能发生在序列化流发生错误的时候。因此，readObjectNoData 方法在”恶意”的或者不完整的流情况下初始化反序列化对象属性是非常有用的。</p>
<p>Serializable 类需要在写入一个对象到流的时候指定一个替换的对象的话需要用指定的修饰符实现这个方法</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ANY-ACCESS-<span class="hljs-function">MODIFIER Object <span class="hljs-title">writeReplace</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ObjectStreamException</span>;</div></pre></td></tr></table></figure>
<p>这个 writeReplace 方法如果存在并且它可以被被序列化的对象中定义的方法调用的话，writeReplace 会在序列化的时候被调用。因此，这个方法可以使用 private , protected 或者 package-private修饰。子类的访问权限遵循 Java 的访问规则。</p>
<p>如果类的实例从流中读取出来的时候需要指定一个替换的类的话应该使用明确的修饰符实现这个方法。</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ANY-ACCESS-<span class="hljs-function">MODIFIER Object <span class="hljs-title">readResolve</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ObjectStreamException</span>;</div></pre></td></tr></table></figure>
<p>readResolve 方法的调用规则和访问规则和 writeReplace 相同。</p>
<p>序列化在运行时会关联每一个可以序列化的类的版本数字，名为 serialVersionUID ， 这个 serialVersionUID 会在反序列化的时候使用，主要作用是验证一个序列化对象的发送方和接收方加载的类是兼容的。如果接收方给对象加载的类的 serialVersionUID 和对应的 发送方的类的 serialVersionUID 不同的话，反序列化的时候会导致一个 <a href="">InvalidClassException</a> . 可序列化的类可以通过定义一个静态 final long 字段名为 “serialVersionUID” 声明它自己的 serialVersionUID :</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ANY-ACCESS-MODIFIER <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">42L</span>;</div></pre></td></tr></table></figure>
<p>如果可序列化的类没有明确的定义一个 serialVersionUID ，那么运行时序列化将会如Java(TM)对象序列化规范所描述的那样依据类的多个方面计算出一个默认的 serialVersionUID 值。尽管如此，官方还是强烈推荐所有的可序列化类明确的定义 serialVersionUID 值，因为默认的 serialVersionUID 计算对类的细节是高度敏感的，会依据编译器的实现而变动，可能会在反序列化时导致预期之外的 InvalidClassException 异常。因此，为了确保在不同的 Java 编译器实现中保持 serialVersionUID 不变，可序列化的类必须明确定义一个 serialVersionUID 值。官方还强烈推荐尽可能使用 private 来修饰 serialVersionUID  定义，因为这样的声明只适用于当前的类，而不会影响那些继承他的类。Array 类不能显式的声明 serialVersionUID ，所以它们总是使用默认计算的值，但是 Array 类不需要比对 serialVersionUID 。</p>
<p>Android 实现的 serialVersionUID 计算方式在 Android N 上会有一些轻微的不同。为了保持兼容性，这个改变只有在应用的目标  SDK 版本设置为 24 或者更高的时候才会可用。强烈推荐使用显式的 serialVersionUID 字段来避免兼容性问题。</p>
<p>谨慎的实现 Serializable<br>参考 《Effective Java》中对于序列化 API 覆盖的章节。书中介绍了如何在不影响应用程序的可维护性的前提下使用这个接口。</p>
<p>推荐另一个可行的方法<br>JSON 是一种简明，可读性高并且高效的方式。Android 包含了 android.util.JsonReader 流 API 和 org.json.JSONObject 树 API 来对 JSON 进行读写。也可以使用绑定库比如 <a href="http://code.google.com/p/google-gson/" target="_blank" rel="external">GSON</a> 来更直接的读写 Java 对象。</p>
<h2><span id="reference">Reference</span></h2><p><a href="https://docs.oracle.com/javase/7/docs/api/java/io/Serializable.html" target="_blank" rel="external">https://docs.oracle.com/javase/7/docs/api/java/io/Serializable.html</a></p>
<h2><span id="about-me">About Me</span></h2><p>我的博客 <a href="http://leonchen1024.com/" target="_blank" rel="external">leonchen1024.com</a></p>
<p>我的 GitHub <a href="https://github.com/LeonChen1024" target="_blank" rel="external">https://github.com/LeonChen1024</a></p>
<p>微信公众号 </p>
<p><img src="https://github.com/LeonChen1024/LeetCodeRecord/blob/master/Images/CooderQRcodem.jpg?raw=false" alt="wechat"></p>
 -->
            <div class="article-entry">
                    
                    
                        
                            
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                            
                                
                                <p><h1><span id="serializable">Serializable</span></h1><p>通过实现 java.io.Serializable 可以让 class 实现序列化的功能，否则无法使用序列化的功能。一个实现序列化的类的子类都是可以进行序列化的。Serializable 接口没有方法，字段等只是一个标记它是可以序列化的作用。</p>
<p>序列化是指将数据结构或对象状态转换成可取用格式（例如存成文件，存于缓冲，或在网络中传送），并在需要的时候恢复原先状态的过程。</p>
<p>当子类实现了 Serializable 接口而父类没有实现的时候，父类要有一个可以访问的无参构造函数。</p>
<p>在反序列化的时候，没有实现序列化的类字段将会使用 public 或者 protect 的无参构造函数进行初始化。无参构造函数必须是实现序列化的子类可访问的，</p>
<p>如果需要在序列化和反序列化的时候进行一些特殊操作的话，需要自己实现以下某些方法：</p>
<p>
                            
                        
                    
                    
                        </div>   
                        <div class="article-more-link">
                            <a href="/2020/05/02/Serializable/#more">Read More</a>
                        </div>
                    
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2020/04/30/Key-Value-pair-in-hashtable/" class="image is-7by1">
            <img class="banner" src="/2020/04/30/Key-Value-pair-in-hashtable/title.jpg" alt="实现键值对存储 第五部分 Hash table 实现">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-04-29T16:00:00.000Z">2020-04-30</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/DataStructure/">DataStructure</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/DataStructure/Common/">Common</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    34 minutes read (About 5083 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/04/30/Key-Value-pair-in-hashtable/">实现键值对存储 第五部分 Hash table 实现</a>
            
        </h1>
        <div class="content">
            <!-- <h1><span id="实现键值对存储-第五部分-hash-table-实现">实现键值对存储-第五部分: Hash table 实现</span></h1><p><a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/" target="_blank" rel="external">原文链接</a></p>
<p>这篇文章是 IKVS 系列的第五部分,”实现一个键值对存储”.你也可以查看 <a href="http://codecapsule.com/2012/11/07/ikvs-implementing-a-key-value-store-table-of-contents/" target="_blank" rel="external">Table of Contents</a>  来查看其他部分.</p>
<p>在这篇文章中,我将会学习C++中实际的 hash table 来理解它的瓶颈在哪里.Hash 函数是 CPU-密集型的操作应该要进行优化.然而,大多数的 hash table 的机制都只是关注于高效的内存和I/O读取,这也是这篇文章主要的焦点.我将会学习三种不同的 C++中的hash table 的实现,同时包含内存中的和硬盘中的,并且会观察这些数据都是怎么组织和访问的.这篇文章将会包含以下内容.</p>
<p>[TOC]</p>
<p><img src="/2020/04/30/Key-Value-pair-in-hashtable/kvstore-part5-intro.jpg" alt="kvstore-part5-intro"></p>
<h2><span id="1-hash-tables">1. Hash tables</span></h2><h3><span id="11-对-hash-tables-的一个快速介绍">1.1 对 hash tables 的一个快速介绍</span></h3><blockquote>
<p>Hashtable 按理说是一个对人类来说最重要的数据结构.</p>
<p>— Steve Yegge</p>
</blockquote>
<p>一个hash table 允许高效的访问关联数据.每一个条目都是一个键值对,只需要知道它的key就可以快速的检索或者分配.为了实现这个效果,key是使用hash函数来计算的,达到将这个key从它原始的表达转换为一个整数.然后使用这个整数作为索引来识别在存储条目值的数组中哪个位置是被访问的.很多key可以被hash到一个相同的值里,这意味着这些key会在这个数组位置碰撞.为了解决冲突问题,有很多中技术可以使用,比如在这个桶里使用 链表 或者 自平衡树等,或者使用 线性探查或者二次探查的开放式寻址.</p>
<p>从现在开始,我会假设你知道hash table 是什么.如果你觉得你需要复习一下相关知识,有一些好的资源是 Wikipidia[1] 上的 “Hash table” 这篇文章(还有页面底部的那些链接部分),还有就是 Cormen et. al [2] 的”Introduction to Algorithms” 这本书中的 Hash table 这个章节.</p>
<h3><span id="12-hash-函数">1.2 Hash 函数</span></h3><p>hash 函数的选择是特别重要的.一个好的 hash 函数最基础的要求就是输出的hash 值应该要分布均匀.这样,发生碰撞的概率就最小化了,同时也缩小了bucket 中碰撞的条目的数量.</p>
<p>这里有很多可以用的hash函数,并且除非你准确的知道这些存储的数据会是什么,否则最安全的做法是使用一个平均情况下分配随机数据最均匀的那个,如果可以的话要适用于”雪崩效应”<a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_3" target="_blank" rel="external">[3]</a>的情况.有一部分人已经在对比hash函数的效率了 <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_4" target="_blank" rel="external">[4]</a> <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_5" target="_blank" rel="external">[5]</a> <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_6" target="_blank" rel="external">[6]</a> <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_7" target="_blank" rel="external">[7]</a>,从他们的结论得知,MurmurHash3 <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_8" target="_blank" rel="external">[8]</a> 和 CityHash <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_9" target="_blank" rel="external">[9]</a> 在这篇文章写完的时候是最好的hash函数.</p>
<h2><span id="2-实现">2. 实现</span></h2><p>如同对比 hash 函数一样,现在也已经有一些博客和文章已经对比了 使用内存的 C++ hash table 库.我看过最值得注意的是 Nick Welch的 “<em>Hash Table Benchmarks</em>”  <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_10" target="_blank" rel="external">[10]</a> 和 Jeff Preshing 的 “<em>Hash Table Performance Tests</em>”  <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_11" target="_blank" rel="external">[11]</a>, 但是还是有一些其他的文章也值得一看 <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_12" target="_blank" rel="external">[12]</a> <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_13" target="_blank" rel="external">[13]</a> <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_14" target="_blank" rel="external">[14]</a>. 通过这些对比,我从 GCC 中的 TR1 派生出了 unordered_map 同时从 SparseHash 库中派生了 dense_hash_map — 之前被叫做 Google SparseHash —这是两个很值得学习的模块,并且下面我也会介绍到.此外,我还会介绍 Kyoto Cabinet 中的 HashDB 里的数据结构.当然  unordered_map 和 dense_hash_map 不会像 HashDB 那样和我的 key-value 存储项目关联性那么大,因为它们是内存内的 hash table . 虽然这样,对它们的内部数据结构的组织和它们的内存模式做一个简单的了解也是很有趣的.</p>
<p>对于这三个 hash table 库的介绍,我将会使用一个通用的例子,将一组城市的名字作为key,将它们的 GPS 坐标作为 value . unordered_map 的源码可以在 GCC 的源码中找到,它是在 libstdc++-v3 中. 我介绍的是基于 GCC v4.8.0中的 libstdc++-v3 release 6.0.18  <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_15" target="_blank" rel="external">[15]</a>,以及 SparseHash v2.0.2 <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_16" target="_blank" rel="external">[16]</a> 中的 dense_hash_map , 还有 Kyoto Cabinet v1.2.76 <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_17" target="_blank" rel="external">[17]</a> 中的 HashDB.</p>
<p>在 Matthew Austern 写的 “<em>A Proposal to Add Hash Tables to the Standard Library (revision 4)</em>”  <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_18" target="_blank" rel="external">[18]</a> 还有 SparseHash 中的  “<em>Implementation notes</em>” 页面 <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_19" target="_blank" rel="external">[19]</a> 中也可以找到关于实现的有意思的讨论.</p>
<h3><span id="21-tr1-的-unordered_map">2.1  TR1 的 unordered_map</span></h3><p>TR1 中的 unordered_map 提供了一个使用链表(单独链路)方式处理碰撞的问题的 hash table . 数组的位置分配是在堆上的,并且根据负载因子来进行扩大或者缩小.一个叫做 <code>_Hash_node</code> 的节点结构是用来创建桶的链表.</p>
<figure class="highlight c++ hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">/* from gcc-4.8.0/libstdc++-v3/include/tr1/hashtable_policy.h */</span> </div><div class="line"><span class="hljs-keyword">template</span></div><div class="line">  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">Hash_node</span>&lt;_Value, false&gt;</span></div><div class="line"><span class="hljs-class">  &#123;</span></div><div class="line">    _Value       _M_v;</div><div class="line">    _Hash_node*  _M_next;</div><div class="line">  &#125;;</div></pre></td></tr></table></figure>
<p>如果 key 和 value 都是整数类型的,它们可以被直接存储到这个结构的 <code>_M_v</code> 里.否则指针将会被使用并且需要一些额外的内存.桶数组在堆上就会被分配,但这并不影响 节点,它们使用的是 C++ 内存分配器中独立的调用:</p>
<figure class="highlight c++ hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">/* from gcc-4.8.0/libstdc++-v3/include/tr1/hashtable.h */</span> </div><div class="line">Node* _M_allocate_node(<span class="hljs-keyword">const</span> value_type&amp; __v)</div><div class="line">    &#123;</div><div class="line">      _Node* __n = _M_node_allocator.allocate(<span class="hljs-number">1</span>);</div><div class="line">      __try</div><div class="line">	&#123;</div><div class="line">	  _M_get_Value_allocator().construct(&amp;__n-&gt;_M_v, __v);</div><div class="line">	  __n-&gt;_M_next = <span class="hljs-number">0</span>;</div><div class="line">	  <span class="hljs-keyword">return</span> __n;</div><div class="line">	&#125;</div><div class="line">      __catch(...)</div><div class="line">	&#123;</div><div class="line">	  _M_node_allocator.deallocate(__n, <span class="hljs-number">1</span>);</div><div class="line">	  __throw_exception_again;</div><div class="line">	&#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>因为节点是独立分配的,每个节点的分配可能会造成大量的内存浪费.这当然也取决于编译器和使用的操作系统的内存分配器.而且我甚至不讨论每种分配器的所有的系统调用.最原始的 SGI hash table 的实现会对节点进行资源预分配,但是这种策略在  TR1 的 unordered_map 实现中没有被保留.</p>
<p>下面的 图 5.1  提供了一个对于 TR1 的  unordered_map 的内存和访问模式.让我们来看看当我们根据key “johannesburg” 来查找关联的 GPS 坐标的时候会发生什么事.这个key 将会被 hash 然后映射到 bucket #0 .从那里我们跳转到这个bucket 对应的链表的第一个节点(bucket #0 左边橙色的箭头),并且我们可以访问堆里持有key “johannesburg” 数据的内存区域(Node 右边黑色的箭头).如果key 在第一个节点是无效的,我们可以指向到其他的节点.</p>
<p>至于CPU 的性能,人们不能指望将所有的数据都放在处理器同一个缓存行里.的确,给定了 bucket 数组的大小,初始化的 bucket 和初始化的节点将不会在同一个缓存行里,并且节点关联的额外的数据也不会在同一个缓存行中.子序列节点和关联的数据也不会在相同的缓存行里并且必须从 RAM 中检索.如果你并不熟悉CPU 优化和缓存行, 这篇 Wikipedia 上的  “<em>CPU Cache</em>”  文章将会是一个很好的介绍 <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_20" target="_blank" rel="external">[20]</a>.</p>
<p><img src="/2020/04/30/Key-Value-pair-in-hashtable/kvstore_unordered_map_web.jpg" alt="Figure 5.1"></p>
<h3><span id="22-sparsehash-的-dense_hash_map">2.2  SparseHash 的 dense_hash_map</span></h3><p>SparseHash 库提供了两种 hash table 的实现, sparse_hash_map 和 dense_hash_map. sparse_hash_map 通过降低了速度提供了惊人的内存占用,并且使用制定的数据结构来获取结果,这就是 sparsetable. 想要了解更多的关于 sparsetables 和 sparse_hash_map 的信息可以去SparseHash  的 “<em>Implementation notes</em>” 页 <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_19" target="_blank" rel="external">[19]</a>.在这里我只会介绍 dense_hash_map.</p>
<p>dense_hash_map 使用二次内部探查处理碰撞问题.如同 unordered_map ,bucket 数组在一开始就在堆里分配了,并且会根据 hash table 的负载因子进行放大或者缩小. bucket 数组的元素是 <code>std::pair</code>  的实例,其中 <code>Key</code> 和 <code>T</code> 分别是 键和值的模板参数.在一个 64-位体系架构中保存字符串, 每一对的实例将会占用 16字节.</p>
<p>下图 5.2  提供了一个对于 dense_hash_map 的内存和访问模式的示意图.如果我们查找 “johannesburg” 的 GPS 坐标,我们一开始会在 bucket #0 中查找失败,因为它的数据是 “Paris” 的(bucket #0 右边的黑色箭头).所以我们会继续探查并跳转到 bucket  (i + 1) = (0 + 1) = 1 (bucket #0 左边橙色的箭头),然后我们会在 bucket #1 中查找 “johannesburg” 对应的数据(bucket #1 右边黑色的箭头).这看起来和 unordered_map 很相似,但实际上是非常不同的.当然,就像 unordered_map 一样键和值将会被存储在堆内存中,这意味着键和值的查找将无法使用缓存行.但是bucket 中的碰撞条目的导航将会变得非常快.的确,在大多数的处理器中缓存行是 64byte , 而我们指定每一对占用16byte的容量,这将会显著的提高我们的速度,和 unordered_map 中的链表相反,它需要在RAM中跳转来得到接下去的节点.</p>
<p>通过二次内部探查提供的缓存行优化使得 dense_hash_map 在 使用内存的 hash table 中的性能测试成为胜利者(至少是我了解的那些).你应该花点时间看一看 Nick Welch  写的 “Hash Table Benchmarks”  <a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_10" target="_blank" rel="external">[10]</a>.</p>
<p><img src="../../../Code/Way%20To%20Google/Foundations/Resource/kvstore_hash_dense_hash_map_web.jpg" alt=""></p>
<h3><span id="23-kyoto-cabinet-的-hashdb">2.3  Kyoto Cabinet 的 HashDB</span></h3><p>Kyoto Cabinet 实现了许多的数据结构,其中也包括 hash table . 比如这个 hash table , HashDB ,是用来在硬盘上持久化的,尽管这里有一个可选方案可以将他作为  <code>std::map</code> 的替代品. hash table 的元数据还有用户数据都是通过文件系统按顺序保存在唯一的一个硬盘文件中.</p>
<p>Kyoto Cabinet 通过在每一个 bucket 上使用独立的二分查找树来处理碰撞问题.bucket 数组有一个固定的大小并且永远不会调整大小,不管负载因子的状态是什么.这是它主要的缺陷.确实,如果在数据库的创建的时候定义的 bucket 数组的大小比实际的需求要小的花,那么当条目开始碰撞的时候性能将会变得很差.</p>
<p>对于一个使用 硬盘的 hash table 实现来说,要让 bucket 数组的大小可以调整是非常困难的.首先,这会要求 bucket 数组还有条目要存储在两个独立的文件里.这样子它们就可以分别增长了.第二,因为需要重新调整 bucket 数组的大小所以需要重新对 key 进行hash操作来对应到它们在新的bucket 数组中位置,这会需要从硬盘中读取所有的条目对应的key,这会非常的消耗性能或者可以说在数量大的数据库情况下来说是不可能的.一个可以避免重新hash的方法是存储 hash 后的key,但是这意味着每一个条目都需要额外 4 或 8 byte 的数据(根据 hash 是 32 还是 64 bit 长的).因为这些种种的复杂性,使用一个定长的 bucket 数组是更简单的,并且这也是 Kyoto Cabinet 中的 HashDB 采用的方法.</p>
<p>图 5.3 展示了存储在文件中的 HashDB 的结构.我从 <code>clac_meta()</code> 方法还有 kchashdb.h 文件底部中的 HashDB 类的代码属性的注释中中派生了这个内部结构.这个文件由以下的部分构成:</p>
<ul>
<li>数据库所有元数据的头部.</li>
<li>FreeBlock pool 用来持有数据区域中的可用空间</li>
<li>bucket 数组</li>
<li>记录(数据区域)</li>
</ul>
<p>一条记录会持有一个条目(键/值对),使用了一个单独连接的二叉搜索树的节点.下面是 Record 的结构:</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">/* from kyotocabinet-1.2.76/kchashdb.h */ </div><div class="line">  /**</div><div class="line">   * Record data.</div><div class="line">   */</div><div class="line">  struct Record &#123;</div><div class="line">    int64_t off;                         ///&lt; offset</div><div class="line">    size_t rsiz;                         ///&lt; whole size</div><div class="line">    size_t psiz;                         ///&lt; size of the padding</div><div class="line">    size_t ksiz;                         ///&lt; size of the key</div><div class="line">    size_t vsiz;                         ///&lt; size of the value</div><div class="line">    int64_t left;                        ///&lt; address of the left child record</div><div class="line">    int64_t right;                       ///&lt; address of the right child record</div><div class="line">    const char* kbuf;                    ///&lt; pointer to the key</div><div class="line">    const char* vbuf;                    ///&lt; pointer to the value</div><div class="line">    int64_t boff;                        ///&lt; offset of the body</div><div class="line">    char* bbuf;                          ///&lt; buffer of the body</div><div class="line">  &#125;;</div></pre></td></tr></table></figure>
<p>观察图 5.4 可以知道硬盘上的记录的组织.我从 kchashdb.h 中的 <code>write_record()</code> 方法中派生了这个结构. 注意它和 Record 的结构是不一样的: 使用硬盘的方式的目标是要最小化占用的空间,同时这个结构的目的还要让它在程序上能够便于使用.所有在 图 5.4 中的字段都是固定长度的,除了 <code>key</code> ,<code>value</code> ,还有 <code>padding</code> ,这些数据当然是根据条目里的数据大小来决定的. <code>left</code> 还有 <code>right</code> 字段是这个二叉搜索树节点的一部分,并在文件中保存了其他记录的偏移量.</p>
<p><img src="../../../Code/Way%20To%20Google/Foundations/Resource/kvstore_hash_kyoto_cabinet_web.jpg" alt="Figure 5.3"></p>
<p>​                        <strong>Figure 5.3</strong></p>
<p><img src="../../../Code/Way%20To%20Google/Foundations/Resource/kvstore_hash_kyoto_cabinet_record_web.jpg" alt=""></p>
<p>​                        <strong>Figure 5.4</strong></p>
<p>如果我们想要访问key “Paris” 的值,我们将会从获取关联 bucket 初始记录的偏移开始,也就是 bucket #0.接下来我们会跳转到这个bucket 的二叉搜索树的头节点(bucket #0 左边的橙色的箭头),它持有了key “Johannesburg” 的数据. key “Paris” 的数据可以通过这个节点的右子节点来访问(“Johannesburg” 记录右边的黑色箭头).二分查找树需要一个 “可对比” 类型以此来对节点进行分类.这里使用的可以对比的类型是将hash 后的key 通过 <code>fold_hash()</code> 方法简化成一个更小的表示.</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">/* from kyotocabinet-1.2.76/kchashdb.h */ </div><div class="line">uint32_t fold_hash(uint64_t hash) &#123;</div><div class="line">  _assert_(true);</div><div class="line">  return (((hash &amp; 0xffff000000000000ULL) &gt;&gt; 48) | ((hash &amp; 0x0000ffff00000000ULL) &gt;&gt; 16)) ^</div><div class="line">      (((hash &amp; 0x000000000000ffffULL) &lt;&lt; 16) | ((hash &amp; 0x00000000ffff0000ULL) &gt;&gt; 16));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>将条目和节点存储在一个记录中在一开始可能会看起来像一个设计错误,但是实际上是非常聪明的.为了存储一个条目的数据,通常需要管理3个不同的数据:bucket , 碰撞 ,还有条目.在给定的 bucket 数组中的bucket 必须按照定义顺序存储,它们只能这么存储并且没有什么可以提升的地方.然后假设我们不存储整数类型而是存储字符串或者可变长 byte 的数组之类的无法被存储在 bucket 自身的东西,另一个内存访问将会需要存储到 bucket 数组之外的区域.因此,在添加新的条目的时候,需要存储碰撞的数据结构和条目的键值.</p>
<p>如果碰撞数据和条目数据是独立存储的,除了需要访问bucket 之外,还需要访问两次硬盘,如果是设置值的情况,这会导致在硬盘上写入3次,可能还是在相隔很远的地方.这意味着磁盘上的随机写入模式,这对于I/O而言是最糟糕的事.现在因为 Kyoto Cabinet 的 HashDB 节点数据和条目数据被存储在了一起,它们可以仅通过一次写入磁盘而不用两次.的确,bucket 还是需要被访问的,但是如果 bucket 数组足够小,它将会被操作系统从磁盘中缓存到 RAM 中,这是 Kyoto Cabinet 最主要的假设,正如 specs 中 “Effective Implementation of Hash Database” 这一章节描述的那样<a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/#ref_" target="_blank" rel="external">[17]</a>.</p>
<p>然而这里还有一个需要关心的是将二分查找树节点和条目一起保存到磁盘上,这会降低读取的速度,至少是在碰撞开始发生的时候.的确,因为节点和条目存储在了一起,要解决 bucket 中的碰撞就意味着要找到记录中持有有效条目的二分查找树,这会需要在磁盘上进行许多随机的读取.这样就可以更好的理解为什么 Kyoto Cabinet 在条目的数量超过 bucket 的时候会出现这样的性能下降的原因.</p>
<p>最后,因为所有的东西都被存储在一个文件中,内存管理都是由 Kyoto Cabinet 自己来处理的,并不是像 unordered_map 还有 dense_hash_map 那样交给操作系统来管理.FreeBlock 结构持有了关于文件中空闲空间的信息,基本上是有关与偏移和大小,可以看下面的介绍:</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">/* from kyotocabinet-1.2.76/kchashdb.h */ </div><div class="line">  /**</div><div class="line">   * Free block data.</div><div class="line">   */</div><div class="line">  struct FreeBlock &#123;</div><div class="line">    int64_t off;                         ///&lt; offset</div><div class="line">    size_t rsiz;                         ///&lt; record size</div><div class="line">    /** comparing operator */</div><div class="line">    bool operator &lt;(const FreeBlock&amp; obj) const &#123;</div><div class="line">      _assert_(true);</div><div class="line">      if (rsiz &lt; obj.rsiz) return true;</div><div class="line">      if (rsiz == obj.rsiz &amp;&amp; off &gt; obj.off) return true;</div><div class="line">      return false;</div><div class="line">    &#125;</div><div class="line">  &#125;;</div></pre></td></tr></table></figure>
<p>所有的 FreeBlock 实例都是在 std::set 中加载的,允许使用 std::set 中的 upper_bound() 方法来检索空闲内存块,就像 <code>fetch_free_block()</code> 方法中那样,调整一个”最适合” 的内存分配策略.当空闲内存块的分布太过碎片化或者在 FreeBlock 池中没有剩余的空间的时候,文件会进行碎片整理.这个碎片整理的过程会移动记录来减小 数据库文件的大小.</p>
<h2><span id="3-结论">3. 结论</span></h2><p>在这篇文章中,我介绍了三种不同的 hash table 库的数据组织和内存访问模式.  TR1 中的 unordered_map   和 SparseHash 中的 dense_hash_map 是在内存中的,   Kyoto Cabinet  中的 HashDB 是在磁盘上的.这三个实现使用了不同的方式来处理碰撞问题,在性能上也有不同的表现.分离 bucket 数据,碰撞数据还有条目数据将会影响性能,这就是  unordered_map 使用的方法.通过将碰撞数据和bucket 存储到一起可以有效的提高速度,就像dense_hash_map 使用的方式 二次内部探查, 或者像 HashDB 使用的方式一样.这些方案都可以提高写入的速度,但是将碰撞数据和bucket 存储到一起还会提高读取速度.</p>
<p>还有一件事是我从学习这些哈希表的库的时候明白的,当设计一个哈希表的数据结构的时候,应该优先考虑将碰撞数据和bucket 数据保存在一起,而不是和条目保存在一起.这是因为就算哈希表是在磁盘上的,bucket 数组和碰撞数据也会小到可以存储在RAM中,这样子随机读取会比在磁盘上的消耗少很多.</p>
<h2><span id="4-references">4. References</span></h2><p>[1] <a href="http://en.wikipedia.org/wiki/Hash_table" target="_blank" rel="external">http://en.wikipedia.org/wiki/Hash_table</a><br>[2] <a href="http://www.amazon.com/Introduction-Algorithms-Thomas-H-Cormen/dp/0262033844/" target="_blank" rel="external">http://www.amazon.com/Introduction-Algorithms-Thomas-H-Cormen/dp/0262033844/</a><br>[3] <a href="http://en.wikipedia.org/wiki/Avalanche_effect" target="_blank" rel="external">http://en.wikipedia.org/wiki/Avalanche_effect</a><br>[4] <a href="http://blog.reverberate.org/2012/01/state-of-hash-functions-2012.html" target="_blank" rel="external">http://blog.reverberate.org/2012/01/state-of-hash-functions-2012.html</a><br>[5] <a href="http://www.strchr.com/hash_functions" target="_blank" rel="external">http://www.strchr.com/hash_functions</a><br>[6] <a href="http://programmers.stackexchange.com/questions/49550/which-hashing-algorithm-is-best-for-uniqueness-and-speed/145633#145633" target="_blank" rel="external">http://programmers.stackexchange.com/questions/49550/which-hashing-algorithm-is-best-for-uniqueness-and-speed/145633#145633</a><br>[7] <a href="http://blog.aggregateknowledge.com/2012/02/02/choosing-a-good-hash-function-part-3/" target="_blank" rel="external">http://blog.aggregateknowledge.com/2012/02/02/choosing-a-good-hash-function-part-3/</a><br>[8] <a href="https://sites.google.com/site/murmurhash/" target="_blank" rel="external">https://sites.google.com/site/murmurhash/</a><br>[9] <a href="http://google-opensource.blogspot.fr/2011/04/introducing-cityhash.html" target="_blank" rel="external">http://google-opensource.blogspot.fr/2011/04/introducing-cityhash.html</a><br>[10] <a href="http://incise.org/hash-table-benchmarks.html" target="_blank" rel="external">http://incise.org/hash-table-benchmarks.html</a><br>[11] <a href="http://preshing.com/20110603/hash-table-performance-tests" target="_blank" rel="external">http://preshing.com/20110603/hash-table-performance-tests</a><br>[12] <a href="http://attractivechaos.wordpress.com/2008/08/28/comparison-of-hash-table-libraries/" target="_blank" rel="external">http://attractivechaos.wordpress.com/2008/08/28/comparison-of-hash-table-libraries/</a><br>[13] <a href="http://attractivechaos.wordpress.com/2008/10/07/another-look-at-my-old-benchmark/" target="_blank" rel="external">http://attractivechaos.wordpress.com/2008/10/07/another-look-at-my-old-benchmark/</a><br>[14] <a href="http://blog.aggregateknowledge.com/2011/11/27/big-memory-part-3-5-google-sparsehash/" target="_blank" rel="external">http://blog.aggregateknowledge.com/2011/11/27/big-memory-part-3-5-google-sparsehash/</a><br>[15] <a href="http://gcc.gnu.org/" target="_blank" rel="external">http://gcc.gnu.org/</a><br>[16] <a href="https://code.google.com/p/sparsehash/" target="_blank" rel="external">https://code.google.com/p/sparsehash/</a><br>[17] <a href="http://fallabs.com/kyotocabinet/spex.html" target="_blank" rel="external">http://fallabs.com/kyotocabinet/spex.html</a><br>[18] <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2003/n1456.html" target="_blank" rel="external">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2003/n1456.html</a><br>[19] <a href="http://sparsehash.googlecode.com/svn/trunk/doc/implementation.html" target="_blank" rel="external">http://sparsehash.googlecode.com/svn/trunk/doc/implementation.html</a><br>[20] <a href="http://en.wikipedia.org/wiki/CPU_cache" target="_blank" rel="external">http://en.wikipedia.org/wiki/CPU_cache</a></p>
<h2><span id="about-me">About Me</span></h2><p>我的博客 <a href="http://leonchen1024.com/" target="_blank" rel="external">leonchen1024.com</a></p>
<p>我的 GitHub <a href="https://github.com/LeonChen1024" target="_blank" rel="external">https://github.com/LeonChen1024</a></p>
<p>微信公众号 </p>
<p><img src="https://github.com/LeonChen1024/LeetCodeRecord/blob/master/Images/CooderQRcodem.jpg?raw=false" alt="wechat"></p>
 -->
            <div class="article-entry">
                    
                    
                        
                            
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                            
                                
                                <p><h1><span id="实现键值对存储-第五部分-hash-table-实现">实现键值对存储-第五部分: Hash table 实现</span></h1><p><a href="http://codecapsule.com/2013/05/13/implementing-a-key-value-store-part-5-hash-table-implementations/" target="_blank" rel="external">原文链接</a></p>
<p>这篇文章是 IKVS 系列的第五部分,”实现一个键值对存储”.你也可以查看 <a href="http://codecapsule.com/2012/11/07/ikvs-implementing-a-key-value-store-table-of-contents/" target="_blank" rel="external">Table of Contents</a>  来查看其他部分.</p>
<p>在这篇文章中,我将会学习C++中实际的 hash table 来理解它的瓶颈在哪里.Hash 函数是 CPU-密集型的操作应该要进行优化.然而,大多数的 hash table 的机制都只是关注于高效的内存和I/O读取,这也是这篇文章主要的焦点.我将会学习三种不同的 C++中的hash table 的实现,同时包含内存中的和硬盘中的,并且会观察这些数据都是怎么组织和访问的.这篇文章将会包含以下内容.</p>
<p>[TOC]</p>
<p><img src="/2020/04/30/Key-Value-pair-in-hashtable/kvstore-part5-intro.jpg" alt="kvstore-part5-intro"></p>
<p>
                            
                        
                    
                    
                        </div>   
                        <div class="article-more-link">
                            <a href="/2020/04/30/Key-Value-pair-in-hashtable/#more">Read More</a>
                        </div>
                    
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2020/04/20/Binary-Search/" class="image is-7by1">
            <img class="banner" src="/2020/04/20/Binary-Search/title.jpg" alt="Binary Search(二分搜索)">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-04-19T16:00:00.000Z">2020-04-20</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/Algorithm/">Algorithm</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/Algorithm/Common/">Common</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    25 minutes read (About 3751 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/04/20/Binary-Search/">Binary Search(二分搜索)</a>
            
        </h1>
        <div class="content">
            <!-- <h1><span id="binary-search二分搜索">Binary Search(二分搜索)</span></h1><p>二分搜索(binary search),也叫做 折半搜索(half-interval search),对数搜索(logarithmic search),对半搜索(binary chop),是一种在有序数组中查找某一特定元素的搜索算法.</p>
<p>二分搜索有几个变体.特别是,分散层叠(<a href="https://en.wikipedia.org/wiki/Fractional_cascading" target="_blank" rel="external">fractional cascading</a>)(将每个数组里的值集合成一个数组,元素为11[0,3,2,0] 的形式,括号内的数字是该值在对应数组中应该返回的数字)提高了在多个数组中查找相同值的效率,高效的解决了一系列计算几何和其他领域的查找问题).指数查找(<a href="https://en.wikipedia.org/wiki/Exponential_search" target="_blank" rel="external">Exponential search</a>)延伸了二分查找到一个没有边界的 list.<a href="https://en.wikipedia.org/wiki/Binary_search_tree" target="_blank" rel="external">binary search tree</a>和<a href="https://en.wikipedia.org/wiki/B-tree" target="_blank" rel="external">B-tree</a>是基于 binary search 延伸的.</p>
<h2><span id="原理">原理</span></h2><p>搜索时从数组中间元素开始,如果中间元素正好是要查找的元素,则搜索过程结束;如果中间元素大于或者小于要查找的元素,则在数组中大于或者小于查找元素的一半中继续查找,重复这个过程直到找到这个元素,或者这一半的大小为空时则代表找不到.这样子每一次比较都使得搜索范围缩小一半.</p>
<h3><span id="步骤">步骤</span></h3><p>给定一个有序数组 A 是 A0,…,An-1并保证 A0&lt;=…&lt;=An-1,以及目标值 T.</p>
<ol>
<li>令 L 为0,R 为 n-1.</li>
<li>如果 L&gt;R 则搜索失败</li>
<li>令m(中间值元素索引)为最大的小于(L+R)/2的整数</li>
<li>如果 Am&lt;T ,令 L=m+1并回到第2步;</li>
<li>如果 Am&gt;T ,令 R=m-1并回到第2步;</li>
<li>当 Am=T,搜索结束;T 所在的索引位置为m.</li>
</ol>
<p><code>变体</code></p>
<ol>
<li>令 L 为0,R 为 n-1.</li>
<li>令 m(中间元素索引) 为上限,也就是最小的大于(L+R)/2的值.</li>
<li>如果 Am&gt;T ,设置 R 为 m-1并且返回第2步</li>
<li>如果 Am&lt;=T ,设置 L 为m 并且返回第2步.</li>
<li>直到 L=R ,搜索完成.这时候如果T=Am,返回 m,否则,搜索失败.</li>
</ol>
<p>在 Am&lt;=T 的时候,这个变体将 L 设置为 m 而不是 m+1.这个方式的比较是更快速的,因为它在每个循环里省略了一次比较.但是平均就会多出来一次循环.在数组包含重复的元素的时候这个变体总是会返回最右侧的元素索引.比如 A 是[1,2,3,4,4,5,6,7]查找的对象是4,那么这个方法会返回 index 4,而不是 index 3.</p>
<h3><span id="大致匹配">大致匹配</span></h3><p>由于有序数组的顺序性,可以将二分搜索扩展到大致匹配.可以用来计算赋值的排名(或称秩,比它更小的元素的数量),前趋(下一个最小元素),后继(下一个最大元素)以及最近邻.还可以使用两个排名查询来执行范围查询.</p>
<ul>
<li>排名查询可以使用调整后的二分搜索来进行.成功时返回m,失败时返回 L, 这样就等于返回了比目标值小的元素数目.</li>
<li>前趋和后继可以使用排名查询来进行.当知道目标值的排名,成功时前趋是排名位置的上一个元素,失败时则是排名位置的元素.它的后继是排名位置的后一个元素,或是前趋的下一个元素.目标值的最近领可能是前趋或后继,取决于哪个更接近目标值.</li>
<li>范围查询,一旦知道范围两边的值的排名,那么大于边界最小值且小于边界最大值的元素排名就是他们的范围,是否包含边界值根据需要处理.</li>
</ul>
<h2><span id="性能分析">性能分析</span></h2><p><strong>时间复杂度</strong><br>二分查找每次把搜索区域减少一半,时间复杂度为<br>$$<br>O(log_2 n)<br>$$<br>(n 是集合中元素的个数)<br>最差的情况是 遍历到最后一层,或者是没有找到该元素的时候,复杂度为 $O(\lfloor log_2 n + 1 \rfloor)$ .</p>
<p>综合复杂度为 $O(log_2 n)$</p>
<p>分散层叠(fractional cascading) 可以提高在多数组中查询相同值的效率. k 是数组的数量,在每个数组中查询目标值消耗 $O(k log n)$ 的时间.分散层叠可以将它降低到 $O(k+log n)$.</p>
<p><code>变体效率分析</code><br>相对于正常的二分搜索,它减少了每次循环的比对次数,但是它必须做完完整的循环,而不会在中间就得到答案.但是在 n 很大的情况下减少了对比次数的提升不能够抵消多余的循环的消耗.</p>
<p><strong>空间复杂度</strong><br>O(1).尾递归,可以改写为循环.</p>
<h2><span id="应用">应用</span></h2><p>查找数组中的元素,或用于插入排序.</p>
<h2><span id="二分搜索和其他的方案对比">二分搜索和其他的方案对比</span></h2><p>使用二分搜索的有序数组在插入和删除操作效率很低,每个操作消耗 O(n) 的时间.其他的数据结构提供了更高效的插入和删除,并且提供了同样高效的完全匹配.然而,二分搜索适用于很多的搜索问题,只消耗 $O(log n)$ 的时间.</p>
<h3><span id="hashing">Hashing</span></h3><p>对于<a href="https://en.wikipedia.org/wiki/Associative_arrays" target="_blank" rel="external">关联数组 (associative arrays)</a>,<a href="https://en.wikipedia.org/wiki/Hash_table" target="_blank" rel="external">哈希表 (hash tables)</a>,他们是通过hash 函数将键映射到记录上的数据结构,通常情况下比在有序数组的情况下使用二分查找要更快.大部分的实现平均开销都是常量级的.然而, hashing 并不适用于模糊匹配,比如计算前趋,后继,以及最近的键,它在失败的查询情况下能给我们的唯一信息就是目标在记录中不存在.二分查找是这种匹配的理想模式,消耗对数级别的时间.</p>
<h3><span id="trees">Trees</span></h3><p><a href="todo">二叉搜索树(binary search tree)</a> 是一个基于二叉搜索原理的<a href="todo">二叉树(binary tree)</a>数据结构.树的记录按照顺序排列,并且每个树里的每个记录都可以使用类似二叉搜索的方法来搜索,平均耗费对数级的时间.插入和删除的平均时间也是对数级的.这会比有序数组消耗的线性时间要快,并且二叉树拥有所有有序数组可以执行的操作,包含范围和模糊查找.</p>
<p>然而二叉搜索通常情况下比二叉搜索树的搜索更有效率,因为二叉搜索树很可能会完全不平衡,导致性能稍差.这同样适用于 <a href="todo">平衡二叉搜索树( balanced binary search trees)</a> , 它平衡了它自己的节点稍微向完全平衡树靠拢.虽然不太可能,但是树有可能只有少数节点有两个子节点导致严重不平衡,这种情况下平均时间损耗和最差的情况差不多都是 O(n) .二叉搜索树比有序数组占用更多的空间.</p>
<p>二叉搜索树因为可以高效的在文件系统中结构化,所以他们可以在硬盘中进行快速搜索.B-tree 泛化了这种树结构的方法.B-tree 常用于组织长时间的存储比如<a href="todo">数据库(databases)</a>和<a href="todo">文件系统(filesystems)</a>.</p>
<h3><span id="linear-search">Linear search</span></h3><p><a href="todo">线性搜索( Linear Search)</a>是一种简单的搜索算法,它查找每一个记录直到找到目标值.线性搜索可以在 链表(linked list) 上使用,它的插入和删除会比在数组上要快.二分搜索比线性搜索要快除非数组很短.如果数组必须先被排序,这个消耗必须在搜索中平摊.对数组进行排序还可以进行有效的近似匹配和其他操作.</p>
<h3><span id="set-membership-algorithms">Set membership algorithms</span></h3><p>一个和搜索相关的问题是<a href="todo">集合成员(set membership)</a>.所有有关查找的算法,比如二分搜索,都可以用于集合成员.还有一些更适用于集合成员的算法,<a href="todo">位数组(bit array)</a>是最简单的一个,在键的范围是有限的时候非常有用.它非常快,是需要O(1)的时间.<a href="todo">朱迪矩阵(Judy array)</a>可以高效的处理64位键.</p>
<p>对于近似结果,<a href="todo">布隆过滤器(Bloom filters)</a>是另外一个基于哈希的概率性数据结构,通过存储使用bit array 和多重 hash 函数编码的键集合. Bloom filters 在大多数情况下空间效率比bit arrays 要高而不会慢太多:使用了 k 重hash 函数,成员查找只需要 O(k) 的时间.然而, Bloom filters 有一定的误判性.</p>
<h3><span id="其他的数据结构">其他的数据结构</span></h3><p>这里存在一些数据结构在某些情况下比在有序数组上使用二分搜索进行查找或其他的操作更加高效.比如,在<a href="todo">van Emde Boas trees</a>, <a href="todo">fusion trees</a>, <a href="todo">前缀树(tries)</a>, 和<a href="todo">位数组</a> 上进行查找,近似匹配,以及其他可用的操作可以比在有序数组上进行二分搜索更加的高效.然而,尽管这些操作可以比在无视键的情况下比有序数组上使用更高效,这样的数据结构通常是因为利用了某些键的属性(键通常是一些小整数),因此如果键缺乏那些属性将会消耗更多的空间或时间.一些结构如朱迪矩阵,使用了多种方式的组合来保证效率和执行近似匹配的能力.</p>
<h2><span id="变体">变体</span></h2><h3><span id="uniform-binary-search">Uniform binary search</span></h3><p>Uniform binary search 不是存储下限和上限的边界值,而是中间元素的索引,和从这次循环的中间元素到下次循环的中间元素的变化.每一步的变化减少一半.比如,要搜索的数组是[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],中间元素是6.Uniform binary search 同时对左边和右边的子数组进行操作.在这个情况下,左边的子数组([1, 2, 3, 4, 5]) 的中间元素 3 而右边的子数组 ([7, 8, 9, 10, 11]) 的中间元素是 9.然后存储3 作为两个中间元素和 6 的差别.为了减少搜索的空间使用,算法同时加上或减去这个和中间元素的改变.这个算法的好处是可以将每次循环的索引的差别存储到一个表里,在某些系统里可以提高算法的性能.</p>
<p><img src="/2020/04/20/Binary-Search/Uniform_binary_search.svg.png" alt=""></p>
<h3><span id="exponential-search">Exponential search</span></h3><p>指数查找(Exponential Search)将二分搜索拓展到无边界数组.它最开始寻找第一个索引是2的幂次方并且要比目标值大的元素的索引.然后,它将这个元素索引设置为上边界,然后开始二分搜索.指数查找消耗 $\lfloor log_2 x =1 \rfloor$ 次循环 ,然后二分搜索消耗 $\lfloor log_2 x \rfloor$ 次循环, x 是目标值的位置.指数查找适用于有界列表,在目标值接近数组开始的位置的时候比二分查找性能有所提高.</p>
<p><img src="/2020/04/20/Binary-Search/Exponential_search.svg.png" alt=""></p>
<h3><span id="interpolation-search">Interpolation search</span></h3><p>内插搜索(Interpolation search)忽略了目标值的位置,计算数组的最低和最高元素的距离即数组的长度.这只有在数组元素是数字的时候才能使用.它适用于中间值不是最好的猜测选择的情况.比如,如果目标值接近数组的最高元素,最好是定位在数组的末端.如果数组的分布是均匀的或者接近均匀的,它消耗 $O(log log n)$ 次比较.</p>
<p>实际上,内插搜索在数组元素较少的情况下是比二分搜索更慢的,因为内插搜索需要额外的计算.尽管它的时间复杂度增长是小于二分搜索的,只有在在大数组的情况下这个计算的损耗可以被弥补.</p>
<p><img src="/2020/04/20/Binary-Search/Interpolation_search.svg.png" alt=""></p>
<h3><span id="fractional-cascading">Fractional cascading</span></h3><p>分散层叠(Fractional cascading) 可以提高在多个有序数组里查找相同的元素或近似匹配的效率,分别在每个数组里查找总共需要 $O(klogn)$的时间, k 是数组的数量.分散层叠通过将每个数组的信息按指定的方式存储起来将这个时间降低到 $O(k+logn)$ .</p>
<p>它将每个数组里的值集合成一个数组,元素为 11[0,3,2,0] 的形式,括号内的数字是该值在对应数组中应该返回的数字)提高了在多个数组中查找相同值的效率,高效的解决了一系列计算几何和其他领域的查找问题</p>
<p>分散层叠被发明的时候是为了高效的解决各种<a href="todo">计算几何学(computational geometry)</a> 问题,但是它同样适用于其他地方,例如 <a href="todo">数据挖掘(data mining)</a> 和 <a href="todo">互联网协议(Internet Protocal)</a> 等.</p>
<h2><span id="实现时的问题">实现时的问题</span></h2><p>要注意中间值的取值方法,如果使用 (L+R)/2 当数组的元素数量很大的时候回造成计算溢出.所以要使用L+(R-L)/2.</p>
<h2><span id="示例">示例</span></h2><p>C 版本- 递归<br><figure class="highlight c hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">binary_search</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> arr[], <span class="hljs-keyword">int</span> start , <span class="hljs-keyword">int</span> end , <span class="hljs-keyword">int</span> khey)</span></span>&#123;</div><div class="line">    <span class="hljs-keyword">if</span> (start &gt; end)</div><div class="line">      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;</div><div class="line"></div><div class="line">    <span class="hljs-keyword">int</span> mid = start +(end - start)/<span class="hljs-number">2</span>;   <span class="hljs-comment">//直接平均可能会溢位,所以用此算法</span></div><div class="line">    <span class="hljs-keyword">if</span> (arr[mid] &gt; khey)</div><div class="line">        <span class="hljs-keyword">return</span> binary_search(arr , start , mid - <span class="hljs-number">1</span> , khey);</div><div class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (arr[mid] &lt; khey)</div><div class="line">        <span class="hljs-keyword">return</span> binary_search(arr , mid + <span class="hljs-number">1</span> , end , khey);</div><div class="line">    <span class="hljs-keyword">else</span></div><div class="line">        <span class="hljs-keyword">return</span> mid;    <span class="hljs-comment">//最后才检测相等的情况是因为大多数搜寻情况不是大于就是小于</span></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>C 版本- while 循环</p>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">binary_search</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> arr[], <span class="hljs-keyword">int</span> start, <span class="hljs-keyword">int</span> end, <span class="hljs-keyword">int</span> khey)</span></span>&#123;</div><div class="line">    <span class="hljs-keyword">int</span> result = <span class="hljs-number">-1</span>;    <span class="hljs-comment">//如果没有搜索到数据返回 -1</span></div><div class="line"></div><div class="line">    <span class="hljs-keyword">int</span> mid;</div><div class="line">    <span class="hljs-keyword">while</span> (start &lt;= end)&#123;</div><div class="line">      mid = start + (end - start)/<span class="hljs-number">2</span> ;    <span class="hljs-comment">//直接平均可能会溢位,所以用此算法</span></div><div class="line">      <span class="hljs-keyword">if</span> (arr[mid] &gt; khey)</div><div class="line">          end = mid<span class="hljs-number">-1</span>;</div><div class="line">      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (arr[mid] &lt; khey)</div><div class="line">          start = mid + <span class="hljs-number">1</span>;</div><div class="line">      <span class="hljs-keyword">else</span>&#123;    <span class="hljs-comment">//最后才检测相等的情况是因为大多数搜寻情况不是大于就是小于</span></div><div class="line">          result = mid;</div><div class="line">          <span class="hljs-keyword">break</span>;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="hljs-keyword">return</span> result;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Python3 递归</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">binary_search</span><span class="hljs-params">(arr, start, end, hkey)</span>:</span></div><div class="line">    <span class="hljs-keyword">if</span> start &gt; end:</div><div class="line">        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span></div><div class="line"></div><div class="line">    mid = start + (end - start) / <span class="hljs-number">2</span></div><div class="line">    <span class="hljs-keyword">if</span> arr[mid] &gt; hkey:</div><div class="line">        <span class="hljs-keyword">return</span> binary_search(arr, start , mid - <span class="hljs-number">1</span>,hkey)</div><div class="line">    <span class="hljs-keyword">if</span> arr[mid] &lt; hkey:</div><div class="line">        <span class="hljs-keyword">return</span> binary_search(arr, mid + <span class="hljs-number">1</span>, end, hkey)</div><div class="line">    <span class="hljs-keyword">return</span> mid</div></pre></td></tr></table></figure>
<p>Python3 while 循环</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">binary_search</span><span class="hljs-params">(arr, start, end, hkey)</span>:</span></div><div class="line">    result = <span class="hljs-number">-1</span></div><div class="line"></div><div class="line">    <span class="hljs-keyword">while</span> start &lt;= end:</div><div class="line">        mid = start + (end - start) / <span class="hljs-number">2</span></div><div class="line">        <span class="hljs-keyword">if</span> arr[mid] &gt; hkey :</div><div class="line">            end = mid - <span class="hljs-number">1</span></div><div class="line">        <span class="hljs-keyword">elif</span> arr[mid] &lt; hkey :</div><div class="line">            start = mid + <span class="hljs-number">1</span></div><div class="line">        <span class="hljs-keyword">else</span> :</div><div class="line">            result = mid</div><div class="line">            <span class="hljs-keyword">break</span></div><div class="line"></div><div class="line">    <span class="hljs-keyword">return</span> result</div></pre></td></tr></table></figure>
<p>Java 递归</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">binarySearch</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] arr, <span class="hljs-keyword">int</span> start, <span class="hljs-keyword">int</span> end, <span class="hljs-keyword">int</span> hkey)</span></span>&#123;</div><div class="line">    <span class="hljs-keyword">if</span> (start &gt; end)</div><div class="line">        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;</div><div class="line"></div><div class="line">    <span class="hljs-keyword">int</span> mid = start + (end - start)/<span class="hljs-number">2</span>;    <span class="hljs-comment">//防止溢位</span></div><div class="line">    <span class="hljs-keyword">if</span> (arr[mid] &gt; hkey)</div><div class="line">        <span class="hljs-keyword">return</span> binarySearch(arr, start, mid - <span class="hljs-number">1</span>, hkey);</div><div class="line">    <span class="hljs-keyword">if</span> (arr[mid] &lt; hkey)</div><div class="line">        <span class="hljs-keyword">return</span> binarySearch(arr, mid + <span class="hljs-number">1</span>, end, hkey);</div><div class="line">    <span class="hljs-keyword">return</span> mid;  </div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Java while 循环</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">binarySearch</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] arr, <span class="hljs-keyword">int</span> start, <span class="hljs-keyword">int</span> end, <span class="hljs-keyword">int</span> hkey)</span></span>&#123;</div><div class="line">    <span class="hljs-keyword">int</span> result = -<span class="hljs-number">1</span>;</div><div class="line"></div><div class="line">    <span class="hljs-keyword">while</span> (start &lt;= end)&#123;</div><div class="line">        <span class="hljs-keyword">int</span> mid = start + (end - start)/<span class="hljs-number">2</span>;    <span class="hljs-comment">//防止溢位</span></div><div class="line">        <span class="hljs-keyword">if</span> (arr[mid] &gt; hkey)</div><div class="line">            end = mid - <span class="hljs-number">1</span>;</div><div class="line">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (arr[mid] &lt; hkey)</div><div class="line">            start = mid + <span class="hljs-number">1</span>;</div><div class="line">        <span class="hljs-keyword">else</span> &#123;</div><div class="line">            result = mid ;  </div><div class="line">            <span class="hljs-keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="hljs-keyword">return</span> result;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2><span id="about-me">About Me</span></h2><p>我的博客 <a href="http://leonchen1024.com/" target="_blank" rel="external">leonchen1024.com</a></p>
<p>我的 GitHub <a href="https://github.com/LeonChen1024" target="_blank" rel="external">https://github.com/LeonChen1024</a></p>
<p>微信公众号 </p>
<p><img src="https://github.com/LeonChen1024/LeetCodeRecord/blob/master/Images/CooderQRcodem.jpg?raw=false" alt="wechat"></p>
<h2><span id="references">References</span></h2><p><a href="https://en.wikipedia.org/wiki/Binary_search_algorithm" target="_blank" rel="external">https://en.wikipedia.org/wiki/Binary_search_algorithm</a></p>
 -->
            <div class="article-entry">
                    
                    
                        
                            
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                            
                                
                                <p><h1><span id="binary-search二分搜索">Binary Search(二分搜索)</span></h1><p>二分搜索(binary search),也叫做 折半搜索(half-interval search),对数搜索(logarithmic search),对半搜索(binary chop),是一种在有序数组中查找某一特定元素的搜索算法.</p>
<p>二分搜索有几个变体.特别是,分散层叠(<a href="https://en.wikipedia.org/wiki/Fractional_cascading" target="_blank" rel="external">fractional cascading</a>)(将每个数组里的值集合成一个数组,元素为11[0,3,2,0] 的形式,括号内的数字是该值在对应数组中应该返回的数字)提高了在多个数组中查找相同值的效率,高效的解决了一系列计算几何和其他领域的查找问题).指数查找(<a href="https://en.wikipedia.org/wiki/Exponential_search" target="_blank" rel="external">Exponential search</a>)延伸了二分查找到一个没有边界的 list.<a href="https://en.wikipedia.org/wiki/Binary_search_tree" target="_blank" rel="external">binary search tree</a>和<a href="https://en.wikipedia.org/wiki/B-tree" target="_blank" rel="external">B-tree</a>是基于 binary search 延伸的.</p>
<h2><span id="原理">原理</span></h2><p>搜索时从数组中间元素开始,如果中间元素正好是要查找的元素,则搜索过程结束;如果中间元素大于或者小于要查找的元素,则在数组中大于或者小于查找元素的一半中继续查找,重复这个过程直到找到这个元素,或者这一半的大小为空时则代表找不到.这样子每一次比较都使得搜索范围缩小一半.</p>
<h3><span id="步骤">步骤</span></h3><p>给定一个有序数组 A 是 A0,…,An-1并保证 A0&lt;=…&lt;=An-1,以及目标值 T.</p>
<ol>
<p>
                            
                        
                    
                    
                        </div>   
                        <div class="article-more-link">
                            <a href="/2020/04/20/Binary-Search/#more">Read More</a>
                        </div>
                    
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2020/04/16/S5ep1-Threading-Performance-101/" class="image is-7by1">
            <img class="banner" src="/2020/04/16/S5ep1-Threading-Performance-101/title.jpg" alt="自定义视图及其性能">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-04-15T16:00:00.000Z">2020-04-16</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/Android/">Android</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/Android/Android-Performance-pattern/">Android Performance pattern</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 382 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/04/16/S5ep1-Threading-Performance-101/">自定义视图及其性能</a>
            
        </h1>
        <div class="content">
            <!-- <h1><span id="线程性能">线程性能</span></h1><p>性能中很关键的一点就是多线程的使用.Android 中很多事件只能在主线程中执行,比如 输入事件,应用程序回调服务,警报等等.</p>
<p>这意味着这些事件会形成一个阻塞队列,这些任务会依次按顺序执行.然而UI 渲染也是在主线程中的,而他们每 16ms 就会渲染一次,来达到一个平滑的过渡,但是如果有大量的其他任务堆积在主线程中,可能会导致你错过某一个 16ms 的渲染机会,导致丢帧的情况.</p>
<p>为了处理这种情况,我们可以把一些耗时较长的任务转移到其他线程处理,这样主线程就能够更快的响应了.Android 中提供了一些有助于这个目的的类.</p>
<ul>
<li>AsyncTask : 帮助你区分 UI 线程和非 UI 线程的工作</li>
<li>HandlerThread : 需要一个 API 回调来指定线程</li>
<li>ThreadPool : 管理大量的并行工作</li>
<li>IntentService : 适合用于后台任务</li>
</ul>
<p>这里没有什么银弹,要注意的是,当你在一个 Activity 中声明了一个内部类(比如 AsyncTask)的时候,它会隐式的持有外部 Activity 的引用,在 Activity 销毁的时候如果线程还在运行会导致内存泄露的情况.</p>
<h1><span id="about-me">About Me</span></h1><p>我的博客 <a href="http://leonchen1024.com/" target="_blank" rel="external">leonchen1024.com</a></p>
<p>我的 GitHub <a href="https://github.com/LeonChen1024" target="_blank" rel="external">https://github.com/LeonChen1024</a></p>
<p>微信公众号 </p>
<p><img src="https://github.com/LeonChen1024/LeetCodeRecord/blob/master/Images/CooderQRcodem.jpg?raw=true" alt="wechat"></p>
 -->
            <div class="article-entry">
                    
                    
                        
                            
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                            
                                
                                <p><h1><span id="线程性能">线程性能</span></h1><p>性能中很关键的一点就是多线程的使用.Android 中很多事件只能在主线程中执行,比如 输入事件,应用程序回调服务,警报等等.</p>
<p>这意味着这些事件会形成一个阻塞队列,这些任务会依次按顺序执行.然而UI 渲染也是在主线程中的,而他们每 16ms 就会渲染一次,来达到一个平滑的过渡,但是如果有大量的其他任务堆积在主线程中,可能会导致你错过某一个 16ms 的渲染机会,导致丢帧的情况.</p>
<p>为了处理这种情况,我们可以把一些耗时较长的任务转移到其他线程处理,这样主线程就能够更快的响应了.Android 中提供了一些有助于这个目的的类.</p>
<ul>
<li>AsyncTask : 帮助你区分 UI 线程和非 UI 线程的工作</li>
<p>
                            
                        
                    
                    
                        </div>   
                        <div class="article-more-link">
                            <a href="/2020/04/16/S5ep1-Threading-Performance-101/#more">Read More</a>
                        </div>
                    
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2020/03/31/Module-dependency-manage/" class="image is-7by1">
            <img class="banner" src="/2020/03/31/Module-dependency-manage/title.jpg" alt="Android 模块依赖版本管理">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-03-30T16:00:00.000Z">2020-03-31</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/Android/">Android</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/Android/版本管理/">版本管理</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 minutes read (About 593 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/03/31/Module-dependency-manage/">Android 模块依赖版本管理</a>
            
        </h1>
        <div class="content">
            <!-- <h1><span id="android-模块依赖版本管理">Android 模块依赖版本管理</span></h1><p>由于 Android 模块化的需要,依赖库要保持统一,但是每次一旦某个模块版本变动,就要手动修改所有模块的版本号未免显得有些繁琐,而且有一些共用的模块可能在不同的项目中要使用不同的版本.所以需要一个统一管理版本模块的方法.</p>
<h1><span id="步骤">步骤</span></h1><h3><span id="1-在项目主目录下新建一个名为-dependencygradle-的文件">1. 在项目主目录下新建一个名为 <code>dependency.gradle</code> 的文件</span></h3><h3><span id="2-在该文件写入配置信息">2. 在该文件写入配置信息</span></h3><figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">ext &#123;</div><div class="line">    </div><div class="line">    ext.deps = [:]</div><div class="line">    <span class="hljs-keyword">def</span> deps = [:]</div><div class="line"></div><div class="line">    <span class="hljs-comment">// 统一的版本号管理</span></div><div class="line">    <span class="hljs-keyword">def</span> versions = [:]</div><div class="line">    versions.kotlin = <span class="hljs-string">"1.3.70"</span></div><div class="line">    versions.android_gradle_plugin = <span class="hljs-string">"3.5.2"</span></div><div class="line">    versions.appcompat = <span class="hljs-string">"1.1.0"</span></div><div class="line">    versions.dagger = <span class="hljs-string">"2.16"</span></div><div class="line">    versions.material = <span class="hljs-string">"1.2.0-alpha03"</span></div><div class="line">    versions.work = <span class="hljs-string">"2.3.0-alpha01"</span></div><div class="line">    versions.retrofit = <span class="hljs-string">"2.3.0"</span></div><div class="line">    versions.recyclerview = <span class="hljs-string">"1.1.0"</span></div><div class="line">    versions.okhttp = <span class="hljs-string">"3.0.1"</span></div><div class="line">    versions.guava = <span class="hljs-string">"20.0"</span></div><div class="line">    versions.navigation = <span class="hljs-string">"2.3.0-alpha01"</span></div><div class="line">    versions.multidex = <span class="hljs-string">"1.0.0"</span></div><div class="line"></div><div class="line"><span class="hljs-comment">//------------------------------------------------------------------------------</span></div><div class="line"></div><div class="line">    <span class="hljs-comment">// 一组依赖可以使用这个方式</span></div><div class="line">    <span class="hljs-keyword">def</span> navigation = [:]</div><div class="line">    navigation.runtime = <span class="hljs-string">"androidx.navigation:navigation-runtime:$versions.navigation"</span></div><div class="line">    navigation.runtime_ktx = <span class="hljs-string">"androidx.navigation:navigation-runtime-ktx:$versions.navigation"</span></div><div class="line">    navigation.fragment = <span class="hljs-string">"androidx.navigation:navigation-fragment:$versions.navigation"</span></div><div class="line">    <span class="hljs-comment">// 这句要记得</span></div><div class="line">    deps.navigation = navigation</div><div class="line">    ...</div><div class="line">    </div><div class="line">    <span class="hljs-comment">// 单个依赖可以使用这中方式</span></div><div class="line">    deps.app_compat = <span class="hljs-string">"androidx.appcompat:appcompat:$versions.appcompat"</span>    </div><div class="line">        </div><div class="line">    <span class="hljs-comment">// app 本身的版本管理也可以放进来</span></div><div class="line">    <span class="hljs-keyword">def</span> build_versions = [:]</div><div class="line">    build_versions.min_sdk = <span class="hljs-number">19</span></div><div class="line">    build_versions.compile_sdk = <span class="hljs-number">29</span></div><div class="line">    build_versions.target_sdk = <span class="hljs-number">29</span></div><div class="line">    build_versions.build_tools = <span class="hljs-string">"29.0.3"</span></div><div class="line">    ext.build_versions = build_versions</div><div class="line">    </div><div class="line">    ext.deps = deps</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如上图所示,配置文件就完成了</p>
<h3><span id="3-使用">3. 使用</span></h3><p>在 root 目录下的 <code>build.gradle</code> 中加上 <code>apply from: &quot;dependency.gradle&quot;</code></p>
<p>在需要添加依赖的 Module 中使用,如下</p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    compileSdkVersion build_versions.compile_sdk</div><div class="line">    buildToolsVersion build_versions.buildToolsVersion</div><div class="line"></div><div class="line">    defaultConfig &#123;</div><div class="line">        minSdkVersion build_versions.minSdkVersion</div><div class="line">        ...</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">    compile fileTree(<span class="hljs-string">dir:</span> <span class="hljs-string">'libs'</span>, <span class="hljs-string">include:</span> [<span class="hljs-string">'*.jar'</span>])</div><div class="line">    implementation deps.app_compat</div><div class="line">    implementation deps.navigation.runtime</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3><span id="tip">tip</span></h3><p>在多应用的情况下,最好是有一个统一的文档对所有的依赖名等做一个规范,避免出现不同项目使用了不同的命名.</p>
<h1><span id="进阶">进阶</span></h1><p>当我们有多个项目的时候,使用同样的一份依赖可以免去大量的重复工作,和版本适配问题.这个时候其实也很简单</p>
<h3><span id="本地版">本地版</span></h3><figure class="highlight gradle hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apply <span class="hljs-keyword">from</span>: <span class="hljs-string">"../../AndroidShareLib/gradle/dependency.gradle"</span></div></pre></td></tr></table></figure>
<p>我们只需要放在一个共有目录下进行索引即可,这样两个项目都可以复用这个依赖文件</p>
<h3><span id="网络版">网络版</span></h3><p>将这个gradle 放在网上,比如git仓库中,然后这里使用连接引用即可</p>
<h1><span id="reference">Reference</span></h1><p><a href="http://leonchen1024.com/2018/04/13/APP-Version-Control/" target="_blank" rel="external">APP 版本控制</a></p>
<h2><span id="about-me">About Me</span></h2><p>我的博客 <a href="http://leonchen1024.com/" target="_blank" rel="external">leonchen1024.com</a></p>
<p>我的 GitHub <a href="https://github.com/LeonChen1024" target="_blank" rel="external">https://github.com/LeonChen1024</a></p>
<p>微信公众号 </p>
<p><img src="https://github.com/LeonChen1024/LeetCodeRecord/blob/master/Images/CooderQRcodem.jpg?raw=false" alt="wechat"></p>
 -->
            <div class="article-entry">
                    
                    
                        
                            
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                            
                                
                                <p><h1><span id="android-模块依赖版本管理">Android 模块依赖版本管理</span></h1><p>由于 Android 模块化的需要,依赖库要保持统一,但是每次一旦某个模块版本变动,就要手动修改所有模块的版本号未免显得有些繁琐,而且有一些共用的模块可能在不同的项目中要使用不同的版本.所以需要一个统一管理版本模块的方法.</p>
<h1><span id="步骤">步骤</span></h1><h3><span id="1-在项目主目录下新建一个名为-dependencygradle-的文件">1. 在项目主目录下新建一个名为 <code>dependency.gradle</code> 的文件</span></h3><h3><span id="2-在该文件写入配置信息">2. 在该文件写入配置信息</span></h3><figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">ext &#123;</div><div class="line">    </div><div class="line">    ext.deps = [:]</div><div class="line">    <span class="hljs-keyword">def</span> deps = [:]</div><div class="line"></div><div class="line">    <span class="hljs-comment">// 统一的版本号管理</span></div><div class="line">    <span class="hljs-keyword">def</span> versions = [:]</div><div class="line">    versions.kotlin = <span class="hljs-string">"1.3.70"</span></div><div class="line">    versions.android_gradle_plugin = <span class="hljs-string">"3.5.2"</span></div><div class="line">    versions.appcompat = <span class="hljs-string">"1.1.0"</span></div><div class="line">    versions.dagger = <span class="hljs-string">"2.16"</span></div><div class="line">    versions.material = <span class="hljs-string">"1.2.0-alpha03"</span></div><div class="line">    versions.work = <span class="hljs-string">"2.3.0-alpha01"</span></div><div class="line">    versions.retrofit = <span class="hljs-string">"2.3.0"</span></div><div class="line">    versions.recyclerview = <span class="hljs-string">"1.1.0"</span></div><div class="line">    versions.okhttp = <span class="hljs-string">"3.0.1"</span></div><div class="line">    versions.guava = <span class="hljs-string">"20.0"</span></div><div class="line">    versions.navigation = <span class="hljs-string">"2.3.0-alpha01"</span></div><div class="line">    versions.multidex = <span class="hljs-string">"1.0.0"</span></div><div class="line"></div><div class="line"><span class="hljs-comment">//------------------------------------------------------------------------------</span></div><div class="line"></div><div class="line">    <span class="hljs-comment">// 一组依赖可以使用这个方式</span></div><div class="line">    <span class="hljs-keyword">def</span> navigation = [:]</div><div class="line">    navigation.runtime = <span class="hljs-string">"androidx.navigation:navigation-runtime:$versions.navigation"</span></div><div class="line">    navigation.runtime_ktx = <span class="hljs-string">"androidx.navigation:navigation-runtime-ktx:$versions.navigation"</span></div><div class="line">    navigation.fragment = <span class="hljs-string">"androidx.navigation:navigation-fragment:$versions.navigation"</span></div><div class="line">    <span class="hljs-comment">// 这句要记得</span></div><div class="line">    deps.navigation = navigation</div><div class="line">    ...</div><div class="line">    </div><div class="line">    <span class="hljs-comment">// 单个依赖可以使用这中方式</span></div><div class="line">    deps.app_compat = <span class="hljs-string">"androidx.appcompat:appcompat:$versions.appcompat"</span>    </div><div class="line">        </div><div class="line">    <span class="hljs-comment">// app 本身的版本管理也可以放进来</span></div><div class="line">    <span class="hljs-keyword">def</span> build_versions = [:]</div><div class="line">    build_versions.min_sdk = <span class="hljs-number">19</span></div><div class="line">    build_versions.compile_sdk = <span class="hljs-number">29</span></div><div class="line">    build_versions.target_sdk = <span class="hljs-number">29</span></div><div class="line">    build_versions.build_tools = <span class="hljs-string">"29.0.3"</span></div><div class="line">    ext.build_versions = build_versions</div><div class="line">    </div><div class="line">    ext.deps = deps</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如上图所示,配置文件就完成了</p>
<h3><span id="3-使用">3. 使用</span></h3><p>在 root 目录下的 <code>build.gradle</code> 中加上 <code>apply from: &quot;dependency.gradle&quot;</code></p>
<p>在需要添加依赖的 Module 中使用,如下</p>
<p>
                            
                        
                    
                    
                        </div>   
                        <div class="article-more-link">
                            <a href="/2020/03/31/Module-dependency-manage/#more">Read More</a>
                        </div>
                    
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2020/03/01/Gradle-Kotlin/" class="image is-7by1">
            <img class="banner" src="/2020/03/01/Gradle-Kotlin/title.jpg" alt="Gradle Kotlin DSL">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-02-29T16:00:00.000Z">2020-03-01</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/Gradle/">Gradle</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 minutes read (About 724 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/03/01/Gradle-Kotlin/">Gradle Kotlin DSL</a>
            
        </h1>
        <div class="content">
            <!-- <h1><span id="gradle-kotlin-dsl">Gradle Kotlin DSL</span></h1><p>[TOC]</p>
<h1><span id="我觉得你们可以先看最后的彩蛋再决定是不是要看">我觉得你们可以先看最后的彩蛋再决定是不是要看</span></h1><p>强烈推荐先看文章最后的彩蛋!!!  </p>
<h1><span id="为什么选择-gradle-kotlin-dsl">为什么选择 Gradle Kotlin DSL</span></h1><p>首先我们要先明确我们这么做的原因有哪些?是否值的我们从 groovy 迁移到 kotlin.</p>
<p>Kotlin 相比于 Groovy 有这么几个好处:</p>
<ul>
<li>可以更好的支持自动补全和内容提示</li>
<li>源码导航</li>
<li>重构等支持</li>
<li>语言和Android开发一致,更加舒适</li>
</ul>
<h1><span id="开始">开始</span></h1><p>首先将所有的 <code>build.gradle</code> 修改为 <code>build.gradle.kts</code> .这个时候运行会报语法错误的.</p>
<p>接下来开始修改,基本上就是使用kotlin的语法替代了原来的groovy语法(虽然我一直没有很了解groovy的语法 )</p>
<p>如果整个过程还不是很了解,下面是一个手把手替换步骤,按照下面步骤就可以了</p>
<h2><span id="1-修改settingsgradle">1. 修改settings.gradle</span></h2><p>更换名字为 <code>settings.gradle.kts</code></p>
<p>将内容 </p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rootProject.name=<span class="hljs-string">'qc'</span></div><div class="line">include <span class="hljs-string">':app'</span></div></pre></td></tr></table></figure>
<p>替换为</p>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">//声明使用build.gradle.kts来构建项目</span></div><div class="line">rootProject.buildFileName = <span class="hljs-string">"build.gradle.kts"</span></div><div class="line">include(<span class="hljs-string">":app"</span>)</div></pre></td></tr></table></figure>
<h2><span id="2-修改项目-buildgradle">2. 修改项目 build.gradle</span></h2><p>一样的,先重命名加上 <code>.kts</code> 后缀为 <code>build.gradle</code></p>
<p>接着将</p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span></div><div class="line"></div><div class="line">buildscript &#123;</div><div class="line">    ext.kotlin_version = <span class="hljs-string">'1.3.70'</span></div><div class="line">    repositories &#123;</div><div class="line">        google()</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">    dependencies &#123;</div><div class="line">        classpath <span class="hljs-string">'com.android.tools.build:gradle:3.6.1'</span></div><div class="line">        classpath <span class="hljs-string">"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"</span></div><div class="line"></div><div class="line">        <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Do not place your application dependencies here; they belong</span></div><div class="line">        <span class="hljs-comment">// in the individual module build.gradle files</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">allprojects &#123;</div><div class="line">    repositories &#123;</div><div class="line">        google()</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">task clean(<span class="hljs-string">type:</span> Delete) &#123;</div><div class="line">    delete rootProject.buildDir</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>替换为</p>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span></div><div class="line"></div><div class="line">buildscript &#123;</div><div class="line">    repositories &#123;</div><div class="line">        google()</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">    dependencies &#123;</div><div class="line">        classpath(<span class="hljs-string">"com.android.tools.build:gradle:3.6.1"</span>)</div><div class="line">        classpath(kotlin(<span class="hljs-string">"gradle-plugin"</span>, version = <span class="hljs-string">"1.3.70"</span>))</div><div class="line"></div><div class="line">        <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Do not place your application dependencies here; they belong</span></div><div class="line">        <span class="hljs-comment">// in the individual module build.gradle files</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">allprojects &#123;</div><div class="line">    repositories &#123;</div><div class="line">        google()</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">tasks.register(<span class="hljs-string">"clean"</span>, Delete::<span class="hljs-class"><span class="hljs-keyword">class</span>) </span>&#123;</div><div class="line">    delete(rootProject.buildDir)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2><span id="3-修改module-的-buildgradle">3. 修改module 的 build.gradle</span></h2><p>老配方,加上<code>.kts</code> 后缀</p>
<p>然后将</p>
<figure class="highlight groovy hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">apply <span class="hljs-string">plugin:</span> <span class="hljs-string">'com.android.application'</span></div><div class="line">apply <span class="hljs-string">plugin:</span> <span class="hljs-string">'kotlin-android'</span></div><div class="line">apply <span class="hljs-string">plugin:</span> <span class="hljs-string">'kotlin-android-extensions'</span></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    compileSdkVersion <span class="hljs-number">29</span></div><div class="line">    buildToolsVersion <span class="hljs-string">"29.0.2"</span></div><div class="line"></div><div class="line">    defaultConfig &#123;</div><div class="line">        applicationId <span class="hljs-string">"com.darenscm.www.qc"</span></div><div class="line">        minSdkVersion <span class="hljs-number">21</span></div><div class="line">        targetSdkVersion <span class="hljs-number">29</span></div><div class="line">        versionCode <span class="hljs-number">1</span></div><div class="line">        versionName <span class="hljs-string">"1.0"</span></div><div class="line"></div><div class="line">        testInstrumentationRunner <span class="hljs-string">"androidx.test.runner.AndroidJUnitRunner"</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    buildTypes &#123;</div><div class="line">       release &#123;</div><div class="line">           minifyEnabled <span class="hljs-literal">false</span></div><div class="line">           proguardFiles getDefaultProguardFile(<span class="hljs-string">'proguard-android-optimize.txt'</span>), <span class="hljs-string">'proguard-rules.pro'</span></div><div class="line">       &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line">    implementation fileTree(<span class="hljs-string">dir:</span> <span class="hljs-string">'libs'</span>, <span class="hljs-string">include:</span> [<span class="hljs-string">'*.jar'</span>])</div><div class="line">implementation <span class="hljs-string">"org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"</span></div><div class="line">    implementation <span class="hljs-string">'androidx.appcompat:appcompat:1.1.0'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>替换为</p>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">import</span> org.jetbrains.kotlin.config.KotlinCompilerVersion</div><div class="line"></div><div class="line">plugins &#123;</div><div class="line">    id(<span class="hljs-string">"com.android.application"</span>)</div><div class="line">    kotlin(<span class="hljs-string">"android"</span>)</div><div class="line">    kotlin(<span class="hljs-string">"android.extensions"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-comment">//apply plugin: 'com.android.application'</span></div><div class="line"><span class="hljs-comment">//apply plugin: 'kotlin-android'</span></div><div class="line"><span class="hljs-comment">//apply plugin: 'kotlin-android-extensions'</span></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    compileSdkVersion(<span class="hljs-number">29</span>)</div><div class="line"></div><div class="line">    defaultConfig &#123;</div><div class="line">        applicationId= <span class="hljs-string">"com.darenscm.www.qc"</span></div><div class="line">        minSdkVersion(<span class="hljs-number">21</span>)</div><div class="line">        targetSdkVersion(<span class="hljs-number">29</span>)</div><div class="line">        versionCode = <span class="hljs-number">1</span></div><div class="line">        versionName = <span class="hljs-string">"1.0"</span></div><div class="line">        testInstrumentationRunner= <span class="hljs-string">"androidx.test.runner.AndroidJUnitRunner"</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    buildTypes &#123;</div><div class="line">        getByName(<span class="hljs-string">"release"</span>) &#123;</div><div class="line">            isMinifyEnabled = <span class="hljs-literal">false</span></div><div class="line">            proguardFiles(getDefaultProguardFile(<span class="hljs-string">"proguard-android.txt"</span>), <span class="hljs-string">"proguard-rules.pro"</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line">    implementation(fileTree(mapOf(<span class="hljs-string">"dir"</span> to <span class="hljs-string">"libs"</span>, <span class="hljs-string">"include"</span> to listOf(<span class="hljs-string">"*.jar"</span>))))</div><div class="line">    implementation(kotlin(<span class="hljs-string">"stdlib-jdk7"</span>, KotlinCompilerVersion.VERSION))</div><div class="line">    implementation(<span class="hljs-string">"androidx.appcompat:appcompat:1.1.0"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>至此就可以运行成功了</p>
<h1><span id="彩蛋">彩蛋!!!!!!!!</span></h1><p>成功运行后,IDE还是全部<strong>报红</strong>!!!</p>
<p>全部报红…很好…..很好… #%^$@%^#&amp;^%&amp;^#%#&amp;^%^@&amp;^</p>
<p>IDE 暂时还不能很好的支持…… 很好…</p>
<p>我撤回前面说的好处,请暂时不要入坑…强迫症表示想死….建议等到工具链完善之后再使用</p>
<p>再见!!</p>
<h2><span id="about-me">About Me</span></h2><p>我的博客 <a href="http://leonchen1024.com/" target="_blank" rel="external">leonchen1024.com</a></p>
<p>我的 GitHub <a href="https://github.com/LeonChen1024" target="_blank" rel="external">https://github.com/LeonChen1024</a></p>
<p>微信公众号 </p>
<p><img src="https://github.com/LeonChen1024/LeetCodeRecord/blob/master/Images/CooderQRcodem.jpg?raw=true" alt="wechat"></p>
 -->
            <div class="article-entry">
                    
                    
                        
                            
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                            
                                
                                <p><h1><span id="gradle-kotlin-dsl">Gradle Kotlin DSL</span></h1><p>[TOC]</p>
<h1><span id="我觉得你们可以先看最后的彩蛋再决定是不是要看">我觉得你们可以先看最后的彩蛋再决定是不是要看</span></h1><p>强烈推荐先看文章最后的彩蛋!!!  </p>
<h1><span id="为什么选择-gradle-kotlin-dsl">为什么选择 Gradle Kotlin DSL</span></h1><p>首先我们要先明确我们这么做的原因有哪些?是否值的我们从 groovy 迁移到 kotlin.</p>
<p>Kotlin 相比于 Groovy 有这么几个好处:</p>
<ul>
<p>
                            
                        
                    
                    
                        </div>   
                        <div class="article-more-link">
                            <a href="/2020/03/01/Gradle-Kotlin/#more">Read More</a>
                        </div>
                    
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/2020/02/26/S1ep5-Tool-Strict-Mode/" class="image is-7by1">
            <img class="banner" src="/2020/02/26/S1ep5-Tool-Strict-Mode/title.jpg" alt="工具 严格模式">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-02-25T16:00:00.000Z">2020-02-26</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/Android/">Android</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Chinese/Android/Android-Performance-pattern/">Android Performance pattern</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 minutes read (About 808 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/02/26/S1ep5-Tool-Strict-Mode/">工具 严格模式</a>
            
        </h1>
        <div class="content">
            <!-- <h1><span id="tool-strict-mode">Tool: Strict Mode</span></h1><p>[TOC]</p>
<h1><span id="背景">背景</span></h1><p>当你的应用中的事件处理超过了 5 秒钟没有响应的时候,Android 会弹出一个 ANR 弹窗. 这是因为 UI 线程被阻塞了,它在等待某些事情的完成.因为 UI 线程是唯一一个可以处理输入和绘制的线程,当它停止响应的时候,你的 app 也停止了响应. </p>
<p>那么什么会导致 UI 线程像这样停止呢?通常情况下系统调用可以无期限的阻塞它,就像磁盘或者网络获取.这些阻塞调用是你应用中的定时炸弹.在正常情况下,它们运行的非常快,你甚至无法注意到他们.但在某些软件和硬件条件以及一些运气的情况下,他们爆炸了.</p>
<h1><span id="方案">方案</span></h1><p>接下来我们来介绍一下如何找到这些隐藏的问题.这个工具的名字叫 Strict Mode ,你可以在 开发者模式中勾选上 <code>Strict Mode Enabled</code> 来启动它.当它是启动的时候,在你的应用中如果有在 UI 线程中的耗时操作的时候屏幕的边框会变成红色的.</p>
<p>Strict Mode 实际上定义了你在什么线程中可以做什么事,它有点像一个运行时的 Lint . 它是对你的线程策略做了一个规定,策略是由两个部分呢组成的</p>
<ul>
<li>检测 : 用来检测某些操作,如网络请求等</li>
<li>处罚 : 当检测到符合条件的行为的时候的响应,如前面的红框,或者记录 log,甚至崩溃.</li>
</ul>
<p>我们也可以使用 Strict mode 来响应一些自定义的条件.比如: 当你要监听自定义的方法的时候,在方法的开始调用 <code>StrictMode.noteSlowCall();</code>  确保你在 UI 线程的策略中启用了 <code>detectCustomSlowCalls</code> . 这时候调用noteSlowCall 将会导致一个异常,然后策略会触发你为该线程设置的 处罚.   如果禁用了  <code>detectCustomSlowCalls</code>  的话 , noteSlowCall 将会是一个空调用.</p>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">StrictMode.noteSlowCall();</div><div class="line"></div><div class="line">StrictMode.setThreadPolicy(</div><div class="line">          <span class="hljs-keyword">new</span> StrictMode.ThreadPolicy.Builder()</div><div class="line">                  .detectCustomSlowCalls()</div><div class="line">                  .penaltyFlashScreen()</div><div class="line">                  .build());</div></pre></td></tr></table></figure>
<p>这里有一个窍门,无论何时你要获取一个锁的时候调用 noteSlowCall . </p>
<p>这是为什么呢? 锁是一个隐式的阻塞调用.它们通常立马就返回了,快到你甚至没有注意到它们在那.但是当他被别人获取的时候,你的线程将会被阻塞,而且没人知道它什么时候可以恢复运行.锁通常不会知道导致 ANR , 但是如果你在 UI 线程中获取锁的话,马上或者以后你将会出现丢帧的情况.</p>
<p>Strict Mode 同时也有给虚拟机设置策略的 API .这就是 VM 策略. VM 策略给了你一个检测内存泄露的方式.要记得,如果你缺少内存的话那么即使是一个小的分配操作也会导致几百毫秒的停顿.</p>
<h1><span id="resource">Resource</span></h1><p><a href="https://www.youtube.com/watch?v=oGrXdxpWgyY&amp;list=PLWz5rJ2EKKc9CBxr3BVjPTPoDPLdPIFCE&amp;index=48" target="_blank" rel="external">https://www.youtube.com/watch?v=oGrXdxpWgyY&amp;list=PLWz5rJ2EKKc9CBxr3BVjPTPoDPLdPIFCE&amp;index=48</a></p>
<h1><span id="about-me">About Me</span></h1><p>我的博客 <a href="http://leonchen1024.com/" target="_blank" rel="external">leonchen1024.com</a></p>
<p>我的 GitHub <a href="https://github.com/LeonChen1024" target="_blank" rel="external">https://github.com/LeonChen1024</a></p>
<p>微信公众号 </p>
<p><img src="https://github.com/LeonChen1024/LeetCodeRecord/blob/master/Images/CooderQRcodem.jpg?raw=true" alt="wechat"></p>
 -->
            <div class="article-entry">
                    
                    
                        
                            
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                                
                                
                            
                            
                                
                                <p><h1><span id="tool-strict-mode">Tool: Strict Mode</span></h1><p>[TOC]</p>
<h1><span id="背景">背景</span></h1><p>当你的应用中的事件处理超过了 5 秒钟没有响应的时候,Android 会弹出一个 ANR 弹窗. 这是因为 UI 线程被阻塞了,它在等待某些事情的完成.因为 UI 线程是唯一一个可以处理输入和绘制的线程,当它停止响应的时候,你的 app 也停止了响应. </p>
<p>那么什么会导致 UI 线程像这样停止呢?通常情况下系统调用可以无期限的阻塞它,就像磁盘或者网络获取.这些阻塞调用是你应用中的定时炸弹.在正常情况下,它们运行的非常快,你甚至无法注意到他们.但在某些软件和硬件条件以及一些运气的情况下,他们爆炸了.</p>
<h1><span id="方案">方案</span></h1><p>接下来我们来介绍一下如何找到这些隐藏的问题.这个工具的名字叫 Strict Mode ,你可以在 开发者模式中勾选上 <code>Strict Mode Enabled</code> 来启动它.当它是启动的时候,在你的应用中如果有在 UI 线程中的耗时操作的时候屏幕的边框会变成红色的.</p>
<p>Strict Mode 实际上定义了你在什么线程中可以做什么事,它有点像一个运行时的 Lint . 它是对你的线程策略做了一个规定,策略是由两个部分呢组成的</p>
<p>
                            
                        
                    
                    
                        </div>   
                        <div class="article-more-link">
                            <a href="/2020/02/26/S1ep5-Tool-Strict-Mode/#more">Read More</a>
                        </div>
                    
        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous is-invisible is-hidden-mobile">
            <a class="is-flex-grow has-text-black-ter" href="/page/0/">Anterior</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/page/2/">Siguiente</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link is-current" href="/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/2/">2</a></li>
            
            <li><span class="pagination-ellipsis has-text-black-ter">&hellip;</span></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/5/">5</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    
                        <img class="image is-128x128 has-mb-6" src="/images/logo.png" alt="Leon Chen">
                    
                    
                    <p class="is-size-4 is-block">
                        Leon Chen
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Software Developer
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Xiamen China</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Entradas
                    </p>
                    <p class="title has-text-weight-normal">
                        43
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categorias
                    </p>
                    <p class="title has-text-weight-normal">
                        22
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Etiquetas
                    </p>
                    <p class="title has-text-weight-normal">
                        18
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/LeonChen1024">
                SEGUIR</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Github" href="https://github.com/LeonChen1024">
                
                <i class="fab fa-github"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        


    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categorias
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="undefined">
            <span class="level-start">
                <span class="level-item">Chinese</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">34</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="undefined">
            <span class="level-start">
                <span class="level-item">Algorithm</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">12</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="undefined">
            <span class="level-start">
                <span class="level-item">Android</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">14</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="undefined">
            <span class="level-start">
                <span class="level-item">DataStructure</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="undefined">
            <span class="level-start">
                <span class="level-item">DesignPattern</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="undefined">
            <span class="level-start">
                <span class="level-item">Gradle</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="undefined">
            <span class="level-start">
                <span class="level-item">Java</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="undefined">
            <span class="level-start">
                <span class="level-item">English</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">9</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="undefined">
            <span class="level-start">
                <span class="level-item">Algorithm</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">9</span>
            </span>
        </a></li></ul></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Nube de etiquetas
        </h3>
        <a href="/tags/Algorithm/" style="font-size: 18.75px;">Algorithm</a> <a href="/tags/Android/" style="font-size: 16.25px;">Android</a> <a href="/tags/Chinese/" style="font-size: 20px;">Chinese</a> <a href="/tags/Custom-View/" style="font-size: 10px;">Custom View</a> <a href="/tags/Data-Structure/" style="font-size: 10px;">Data Structure</a> <a href="/tags/DataStructure/" style="font-size: 10px;">DataStructure</a> <a href="/tags/DesignPattern/" style="font-size: 11.25px;">DesignPattern</a> <a href="/tags/English/" style="font-size: 15px;">English</a> <a href="/tags/Error/" style="font-size: 10px;">Error</a> <a href="/tags/Gradle/" style="font-size: 11.25px;">Gradle</a> <a href="/tags/Java/" style="font-size: 13.75px;">Java</a> <a href="/tags/Jetpack/" style="font-size: 11.25px;">Jetpack</a> <a href="/tags/LeetCode/" style="font-size: 17.5px;">LeetCode</a> <a href="/tags/Optimize/" style="font-size: 13.75px;">Optimize</a> <a href="/tags/SourceCode/" style="font-size: 10px;">SourceCode</a> <a href="/tags/UI/" style="font-size: 10px;">UI</a> <a href="/tags/版本差异/" style="font-size: 11.25px;">版本差异</a> <a href="/tags/版本管理/" style="font-size: 12.5px;">版本管理</a>
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recientes
        </h3>
        
        <article class="media">
            
            <a href="/2020/07/28/Trie/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/2020/07/28/Trie/titleThumb.jpg" alt="Trie(前缀树)">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-07-27T16:00:00.000Z">2020-07-28</time></div>
                    <a href="/2020/07/28/Trie/" class="has-link-black-ter is-size-6">Trie(前缀树)</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a> / <a class="has-link-grey -link" href="/categories/Chinese/Algorithm/">Algorithm</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/06/03/dependency-injection/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/2020/06/03/dependency-injection/titleThumb.jpg" alt="依赖注入">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-06-02T16:00:00.000Z">2020-06-03</time></div>
                    <a href="/2020/06/03/dependency-injection/" class="has-link-black-ter is-size-6">依赖注入</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a> / <a class="has-link-grey -link" href="/categories/Chinese/DesignPattern/">DesignPattern</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/06/03/ioc/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/2020/06/03/ioc/titleThumb.jpg" alt="IoC 控制反转">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-06-02T16:00:00.000Z">2020-06-03</time></div>
                    <a href="/2020/06/03/ioc/" class="has-link-black-ter is-size-6">IoC 控制反转</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a> / <a class="has-link-grey -link" href="/categories/Chinese/DesignPattern/">DesignPattern</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/02/Serializable/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/2020/05/02/Serializable/titleThumb.jpg" alt="Serializable">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-01T16:00:00.000Z">2020-05-02</time></div>
                    <a href="/2020/05/02/Serializable/" class="has-link-black-ter is-size-6">Serializable</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a> / <a class="has-link-grey -link" href="/categories/Chinese/Java/">Java</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/04/30/Key-Value-pair-in-hashtable/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/2020/04/30/Key-Value-pair-in-hashtable/titleThumb.jpg" alt="实现键值对存储 第五部分 Hash table 实现">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-04-29T16:00:00.000Z">2020-04-30</time></div>
                    <a href="/2020/04/30/Key-Value-pair-in-hashtable/" class="has-link-black-ter is-size-6">实现键值对存储 第五部分 Hash table 实现</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a> / <a class="has-link-grey -link" href="/categories/Chinese/DataStructure/">DataStructure</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archivos
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">July 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/06/">
                <span class="level-start">
                    <span class="level-item">June 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">May 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">April 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">March 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">February 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">January 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">July 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">June 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">May 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">April 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">January 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">December 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">September 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">August 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">July 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">April 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">January 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">February 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">August 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/03/">
                <span class="level-start">
                    <span class="level-item">March 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Etiquetas
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Algorithm/">
                        <span class="tag">Algorithm</span>
                        <span class="tag is-grey">22</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android/">
                        <span class="tag">Android</span>
                        <span class="tag is-grey">17</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Chinese/">
                        <span class="tag">Chinese</span>
                        <span class="tag is-grey">34</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Custom-View/">
                        <span class="tag">Custom View</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Data-Structure/">
                        <span class="tag">Data Structure</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/DataStructure/">
                        <span class="tag">DataStructure</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/DesignPattern/">
                        <span class="tag">DesignPattern</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/English/">
                        <span class="tag">English</span>
                        <span class="tag is-grey">9</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Error/">
                        <span class="tag">Error</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Gradle/">
                        <span class="tag">Gradle</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Java/">
                        <span class="tag">Java</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Jetpack/">
                        <span class="tag">Jetpack</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/LeetCode/">
                        <span class="tag">LeetCode</span>
                        <span class="tag is-grey">18</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Optimize/">
                        <span class="tag">Optimize</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SourceCode/">
                        <span class="tag">SourceCode</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/UI/">
                        <span class="tag">UI</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/版本差异/">
                        <span class="tag">版本差异</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/版本管理/">
                        <span class="tag">版本管理</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recientes
        </h3>
        
        <article class="media">
            
            <a href="/2020/07/28/Trie/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/2020/07/28/Trie/titleThumb.jpg" alt="Trie(前缀树)">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-07-27T16:00:00.000Z">2020-07-28</time></div>
                    <a href="/2020/07/28/Trie/" class="has-link-black-ter is-size-6">Trie(前缀树)</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a> / <a class="has-link-grey -link" href="/categories/Chinese/Algorithm/">Algorithm</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/06/03/dependency-injection/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/2020/06/03/dependency-injection/titleThumb.jpg" alt="依赖注入">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-06-02T16:00:00.000Z">2020-06-03</time></div>
                    <a href="/2020/06/03/dependency-injection/" class="has-link-black-ter is-size-6">依赖注入</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a> / <a class="has-link-grey -link" href="/categories/Chinese/DesignPattern/">DesignPattern</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/06/03/ioc/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/2020/06/03/ioc/titleThumb.jpg" alt="IoC 控制反转">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-06-02T16:00:00.000Z">2020-06-03</time></div>
                    <a href="/2020/06/03/ioc/" class="has-link-black-ter is-size-6">IoC 控制反转</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a> / <a class="has-link-grey -link" href="/categories/Chinese/DesignPattern/">DesignPattern</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/02/Serializable/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/2020/05/02/Serializable/titleThumb.jpg" alt="Serializable">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-01T16:00:00.000Z">2020-05-02</time></div>
                    <a href="/2020/05/02/Serializable/" class="has-link-black-ter is-size-6">Serializable</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a> / <a class="has-link-grey -link" href="/categories/Chinese/Java/">Java</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/04/30/Key-Value-pair-in-hashtable/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/2020/04/30/Key-Value-pair-in-hashtable/titleThumb.jpg" alt="实现键值对存储 第五部分 Hash table 实现">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-04-29T16:00:00.000Z">2020-04-30</time></div>
                    <a href="/2020/04/30/Key-Value-pair-in-hashtable/" class="has-link-black-ter is-size-6">实现键值对存储 第五部分 Hash table 实现</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Chinese/">Chinese</a> / <a class="has-link-grey -link" href="/categories/Chinese/DataStructure/">DataStructure</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archivos
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">July 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/06/">
                <span class="level-start">
                    <span class="level-item">June 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">May 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">April 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">March 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">February 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">January 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">July 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">June 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">May 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">April 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">January 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">December 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">September 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">August 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">July 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">April 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">January 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">February 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">August 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/03/">
                <span class="level-start">
                    <span class="level-item">March 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Etiquetas
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Algorithm/">
                        <span class="tag">Algorithm</span>
                        <span class="tag is-grey">22</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android/">
                        <span class="tag">Android</span>
                        <span class="tag is-grey">17</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Chinese/">
                        <span class="tag">Chinese</span>
                        <span class="tag is-grey">34</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Custom-View/">
                        <span class="tag">Custom View</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Data-Structure/">
                        <span class="tag">Data Structure</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/DataStructure/">
                        <span class="tag">DataStructure</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/DesignPattern/">
                        <span class="tag">DesignPattern</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/English/">
                        <span class="tag">English</span>
                        <span class="tag is-grey">9</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Error/">
                        <span class="tag">Error</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Gradle/">
                        <span class="tag">Gradle</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Java/">
                        <span class="tag">Java</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Jetpack/">
                        <span class="tag">Jetpack</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/LeetCode/">
                        <span class="tag">LeetCode</span>
                        <span class="tag is-grey">18</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Optimize/">
                        <span class="tag">Optimize</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SourceCode/">
                        <span class="tag">SourceCode</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/UI/">
                        <span class="tag">UI</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/版本差异/">
                        <span class="tag">版本差异</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/版本管理/">
                        <span class="tag">版本管理</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.png" alt="LeonChen&#39;s Blog" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 LeonChen&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        href="http://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/LeonChen1024/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Entradas',
                PAGES: 'Pages',
                CATEGORIES: 'Categorias',
                TAGS: 'Etiquetas',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>